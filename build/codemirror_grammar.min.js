/**
*
*   CodeMirrorGrammar
*   Transform a grammar specification in JSON format,
*   into a CodeMirror syntax-highlight parser mode
*
*   https://github.com/foo123/codemirror-grammar
*
**/(function(){var e="0.1",n=(Array.prototype.slice,Object.prototype.hasOwnProperty),t=Object.prototype.toString,l=function(e){return"number"==typeof e||e instanceof Number},r=function(e){return e&&("string"==typeof e||e instanceof String)&&1==e.length},s=function(e){return e&&("string"==typeof e||e instanceof String)},i=function(e){return e&&("[object RegExp]"==t.call(e)||e instanceof RegExp)},o=function(e){return e&&"[object Array]"==t.call(e)},u=function(e){return e&&"[object Object]"==t.call(e)},a=function(e){return o(e)?e:[e]},k=function(e){if(!u(e)&&!o(e))return e;var t={};for(var l in e)n.call(e,l)&&(t[l]=u(e[l])?k(e[l]):o(e[l])?e[l].slice():e[l]);return t},d=function(e,t){if(!u(t)&&!o(t))return k(e);var l={};for(var r in t)n.call(t,r)&&(l[r]=n.call(e,r)?u(e[r])&&!s(e[r])?d(e[r],t[r]):o(e[r])?e[r].slice():e[r]:k(t[r]));return l},b={RegExpID:null,RegExpGroups:null,style:{error:"error",comment:"comment",meta:"meta",defines:"def",atom:"atom",keyword:"keyword",builtin:"builtin",operator:"operator",identifier:"variable",identifier2:"variable",identifier3:"variable",identifier4:"variable",identifier5:"variable",number:"number",number2:"number",number3:"number",string:"string",string2:"string",string3:"string",block:"string",block2:"string",block3:"string",block4:"string",block5:"string",delimiter:"meta"},comments:{line:null,block:null},blocks:null,blocks2:null,blocks3:null,blocks4:null,blocks5:null,identifiers:null,identifiers2:null,identifiers3:null,identifiers4:null,identifiers5:null,numbers:null,numbers2:null,numbers3:null,strings:null,strings2:null,strings3:null,operators:{one:null,two:null,words:null},delimiters:{one:null,two:null,three:null},atoms:null,meta:null,defines:null,keywords:null,builtins:null,indent:null},m={RegExpID:null,RegExpGroups:null,style:{error:"error",comment:"comment",meta:"meta",defines:"def",atom:"atom",keyword:"keyword",builtin:"builtin",operator:"operator",assignment:null,tag:"tag",tag2:"tag",tag3:"tag",attribute:"attribute",attribute2:"attribute",attribute3:"attribute",identifier:"variable",identifier2:"variable",identifier3:"variable",identifier4:"variable",identifier5:"variable",number:"number",number2:"number",number3:"number",string:"string",string2:"string",string3:"string",block:"string",block2:"string",block3:"string",block4:"string",block5:"string",delimiter:"meta"},comments:{line:null,block:null},blocks:null,blocks2:null,blocks3:null,blocks4:null,blocks5:null,tags:null,tags2:null,tags3:null,autoclose:null,attributes:null,attributes2:null,attributes3:null,identifiers:null,identifiers2:null,identifiers3:null,identifiers4:null,identifiers5:null,numbers:null,numbers2:null,numbers3:null,strings:null,strings2:null,strings3:null,atoms:null,meta:null,defines:null,keywords:null,builtins:null,assignments:null,operators:{one:null,two:null,words:null},delimiters:{one:null,two:null,three:null},indent:null},c=1,f=2,g=4,p=8,y=16,v=32,z=64,T=128,w=256,h=512,x=1024,E=2048,_=4096,R=8192,G=16384,I=32768,D=65536,L=131072,S=262144,A=200,M=220,U=300,j=310,F=320,O=/([\-\.\*\+\?\^\$\{\}\(\)\|\[\]\/\\])/g,P=function(e,n){if(!e||l(e))return e;var t=n?n.length:0;return t&&n==e.substr(0,t)?new RegExp("^"+e.substr(t)):e},C=function(e){for(var n=0,t=e.length;t>n;n++)e[n]=e[n].replace(O,"\\$1");return new RegExp("^(("+e.join(")|(")+"))\\b")},N=function(e,n){var t,o;return n=n||0,l(e)?e:r(e)?(t=function(t,l){l=!1!==l;var r=e,s=t.string.charAt(t.pos)||"";return r==s?(l&&(t.pos+=1),{key:n,val:s}):!1},t.__type=U,t):s(e)?(o=e.length,t=function(t,l){l=!1!==l;var r=e,s=t.string.substr(t.pos,o),i=s;return r==i?(l&&(t.pos+=o),{key:n,val:s}):!1},t.__type=j,t):i(e)?(t=function(t,l){l=!1!==l;var r=t.string.slice(t.pos).match(e);return!r||r.index>0?!1:(l&&(t.pos+=r[0].length),{key:n,val:r})},t.__type=F,t):e},$=function(e,n,t){if(t)return[N(C(a(e)))];var l,r,s;for(l=a(e),r=0,s=l.length;s>r;r++)l[r]=N(P(l[r],n),r);return l},V=function(e,n){var t,l,r,s,i,u,k;for(s=[],i=[],t=a(e),o(t[0])||(t=[t]),l=0,r=t.length;r>l;l++)u=N(P(t[l][0],n),l),k=t[l].length>1?N(P(t[l][1],n),l):u,s.push(u),i.push(k);return{start:s,end:i}},q=function(e,n,t){var l,r,s=n.length;for(l=0;s>l;l++)if(r=n[l](e,t))return r;return!1},B=function(e,n,t,l){var r;return r=null==e?function(e,r){return e.skipToEnd(),r.tokenize=l||null,r.lastToken=n,t}:function(r,s){for(var i=!1;!r.eol();){if(e(r)){i=!0;break}r.next()}return i&&(s.tokenize=l||null),s.lastToken=n,t},r.__type=n,r},H=function(e,n,t,l){var r=function(r,s){for(var i,o=!1,u=!1;!r.eol();){if(e(r)&&!o){u=!0;break}i=r.next(),o=!o&&"\\"==i}return(u||!o&&!t)&&(s.tokenize=l||null),s.lastToken=T,n};return r.__type=T,r},J=function(e,n,t){var l=n.DEFAULT,r=n.style,s=n.tags,i=n.attributes,o=n.assignments,u=n.strings,a=n.stringsEnd,k=!1,d=function(n,b){var m;return b.lastToken,!k&&s&&(m=q(n,s))?(b.lastToken=x,k=!0,r.tag):k?n.eatSpace()?(b.lastToken=c,l):e(n)?(b.tokenize=t||null,b.lastToken=R,r.tag):i&&q(n,i)?(b.lastToken=E,r.attribute):o&&q(n,o)?(b.lastToken=_,l):u&&(m=q(n,u))?(b.tokenize=H(N(a[m.key]),r.string,!1,d),b.tokenize(n,b)):(b.lastToken=c,l):(b.lastToken=G,r.error)};return d.__type=x,d},K=function(e,n){var t=function(t,l){for(var r,s=!1,i=1;!s&&(r=t.next(),null!=r);)if("<"!=r)if(">"!=r);else{if(1==i){l.tokenize=n||null;break}i--}else i++;return l.lastToken=D,e};return t.__type=D,t},Q=function(e,n,t){var r=n.DEFAULT,s=t.multiLineStrings,i=e.style,o=e.comments.start||null,u=e.comments.end||null,a=e.blocks.start||null,k=e.blocks.end||null,d=e.blocks2.start||null,b=e.blocks2.end||null,m=e.blocks3.start||null,T=e.blocks3.end||null,x=e.blocks4.start||null,E=e.blocks4.end||null,_=e.blocks5.start||null,R=e.blocks5.end||null,G=e.strings.start||null,D=e.strings.end||null,M=e.strings2.start||null,U=e.strings2.end||null,j=e.strings3.start||null,F=e.strings3.end||null,O=e.identifiers,P=e.identifiers2,C=e.identifiers3,$=e.identifiers4,V=e.identifiers5,J=e.numbers,K=e.numbers2,Q=e.numbers3,W=e.atoms,X=e.meta,Y=e.defines,Z=e.keywords,en=e.builtins,nn=e.operators,tn=e.delimiters;e.hasIndent,e.indent;var ln=function(e,n){var t,A,ln;return e.eatSpace()?(n.lastToken=c,r):o&&(A=q(e,o))?(ln=u[A.key],l(ln)&&(ln=A.val[ln]),n.tokenize=B(N(ln),g,i.comment),n.tokenize(e,n)):a&&(A=q(e,a))?(ln=k[A.key],l(ln)&&(ln=A.val[ln]),n.tokenize=B(N(ln),I,i.block),n.tokenize(e,n)):d&&(A=q(e,d))?(ln=b[A.key],l(ln)&&(ln=A.val[ln]),n.tokenize=B(N(ln),I,i.block2),n.tokenize(e,n)):m&&(A=q(e,m))?(ln=T[A.key],l(ln)&&(ln=A.val[ln]),n.tokenize=B(N(ln),I,i.block3),n.tokenize(e,n)):x&&(A=q(e,x))?(ln=E[A.key],l(ln)&&(ln=A.val[ln]),n.tokenize=B(N(ln),I,i.block4),n.tokenize(e,n)):_&&(A=q(e,_))?(ln=R[A.key],l(ln)&&(ln=A.val[ln]),n.tokenize=B(N(ln),I,i.block5),n.tokenize(e,n)):J&&q(e,J)?(n.lastToken=h,i.number):K&&q(e,K)?(n.lastToken=h,i.number2):Q&&q(e,Q)?(n.lastToken=h,i.number3):G&&(A=q(e,G))?(ln=D[A.key],l(ln)&&(ln=A.val[ln]),n.tokenize=H(N(ln),i.string,s),n.tokenize(e,n)):M&&(A=q(e,M))?(ln=U[A.key],l(ln)&&(ln=A.val[ln]),n.tokenize=H(N(ln),i.string2,s),n.tokenize(e,n)):j&&(A=q(e,j))?(ln=F[A.key],l(ln)&&(ln=A.val[ln]),n.tokenize=H(N(ln),i.string3,s),n.tokenize(e,n)):tn&&(tn.three&&q(e,tn.three)||tn.two&&q(e,tn.two))?(n.lastToken=S,i.delimiter):nn&&(nn.two&&q(e,nn.two)||nn.one&&q(e,nn.one)||nn.words&&q(e,nn.words))?(n.lastToken=L,i.operator):tn&&tn.one&&q(e,tn.one)?(n.lastToken=S,i.delimiter):W&&q(e,W)?(n.lastToken=y,i.atom):X&&q(e,X)?(n.lastToken=f,i.meta):Y&&q(e,Y)?(n.lastToken=p,i.defines):Z&&q(e,Z)?(t=e.current(),n.lastToken=v,i.keyword):en&&q(e,en)?(t=e.current(),n.lastToken=z,i.builtin):O&&q(e,O)?(n.lastToken=w,i.identifier):P&&q(e,P)?(n.lastToken=w,i.identifier2):C&&q(e,C)?(n.lastToken=w,i.identifier3):$&&q(e,$)?(n.lastToken=w,i.identifier4):V&&q(e,V)?(n.lastToken=w,i.identifier5):(e.next(),n.lastToken=c,r)};return ln.__type=A,ln},W=function(e,n){var t=n.DEFAULT,r=e.style,s=e.comments.start||null,i=e.comments.end||null,o=e.blocks.start||null,u=e.blocks.end||null,a=e.blocks2.start||null,k=e.blocks2.end||null,d=e.blocks3.start||null,b=e.blocks3.end||null,m=e.blocks4.start||null,T=e.blocks4.end||null,h=e.blocks5.start||null,x=e.blocks5.end||null,E=e.strings.start||null,_=e.strings.end||null,R=e.strings2.start||null,G=e.strings2.end||null,D=e.strings3.start||null,L=e.strings3.end||null,S=e.doctype,A=e.tags.start||null,M=e.tags.tags||null,U=e.tags.end||null,j=e.attributes,F=(e.attributes2,e.attributes3,e.assignments),O=e.identifiers,P=e.identifiers2,C=e.identifiers3,$=e.identifiers4,V=e.identifiers5,Q=(e.numbers,e.numbers2,e.numbers3,e.atoms),W=e.meta,X=e.defines,Y=e.keywords,Z=e.builtins;return e.operators,e.delimiters,e.hasIndent,e.indent,function(e,en){var nn,tn,ln;return e.eatSpace()?(en.lastToken=c,t):s&&(tn=q(e,s))?(ln=i[tn.key],l(ln)&&(ln=tn.val[ln]),en.tokenize=B(N(ln),g,r.comment),en.tokenize(e,en)):o&&(tn=q(e,o))?(ln=u[tn.key],l(ln)&&(ln=tn.val[ln]),en.tokenize=B(N(ln),I,r.block),en.tokenize(e,en)):a&&(tn=q(e,a))?(ln=k[tn.key],l(ln)&&(ln=tn.val[ln]),en.tokenize=B(N(ln),I,r.block2),en.tokenize(e,en)):d&&(tn=q(e,d))?(ln=b[tn.key],l(ln)&&(ln=tn.val[ln]),en.tokenize=B(N(ln),I,r.block3),en.tokenize(e,en)):m&&(tn=q(e,m))?(ln=T[tn.key],l(ln)&&(ln=tn.val[ln]),en.tokenize=B(N(ln),I,r.block4),en.tokenize(e,en)):h&&(tn=q(e,h))?(ln=x[tn.key],l(ln)&&(ln=tn.val[ln]),en.tokenize=B(N(ln),I,r.block5),en.tokenize(e,en)):S&&q(e,S)?(en.tokenize=K(r.doctype),en.tokenize(e,en)):Q&&q(e,Q)?(en.lastToken=y,r.atom):E&&(tn=q(e,E))?(ln=_[tn.key],l(ln)&&(ln=tn.val[ln]),en.tokenize=H(N(ln),r.string,!1),en.tokenize(e,en)):R&&(tn=q(e,R))?(ln=G[tn.key],l(ln)&&(ln=tn.val[ln]),en.tokenize=H(N(ln),r.string2,!1),en.tokenize(e,en)):D&&(tn=q(e,D))?(ln=L[tn.key],l(ln)&&(ln=tn.val[ln]),en.tokenize=H(N(ln),r.string3,!1),en.tokenize(e,en)):W&&q(e,W)?(en.lastToken=f,r.meta):A&&(tn=q(e,A))?(ln=U[tn.key],l(ln)&&(ln=tn.val[ln]),n.style=r,n.tags=M,n.attributes=j,n.assignments=F,n.strings=E,n.stringsEnd=_,en.tokenize=J(N(ln),n),en.tokenize(e,en)):X&&q(e,X)?(en.lastToken=p,r.defines):Y&&q(e,Y)?(nn=e.current(),en.lastToken=v,r.keyword):Z&&q(e,Z)?(nn=e.current(),en.lastToken=z,r.builtin):O&&q(e,O)?(en.lastToken=w,r.identifier):P&&q(e,P)?(en.lastToken=w,r.identifier2):C&&q(e,C)?(en.lastToken=w,r.identifier3):$&&q(e,$)?(en.lastToken=w,r.identifier4):V&&q(e,V)?(en.lastToken=w,r.identifier5):(e.next(),en.lastToken=c,t)}},X=function(e,n,t,l){t.DEFAULT,t.basecolumn||0,l.indentUnit,n.hasIndent;var r=function(n,l){var r,s,i;return t.indentInfo=null,null==l.tokenize&&(l.tokenize=e),r=l.tokenize(n,l),s=l.lastToken,i=n.current(),r};return r.__type=M,r},Y=function(e,n){return e.DEFAULT,e.basecolumn||0,n.indentUnit,function(){return CodeMirror.Pass}},Z={VERSION:e,parseGrammar:function(e,n){return e.type&&"markup-like"==e.type?Z.parseMarkupLikeGrammar(e,n||m):Z.parseProgrammingLikeGrammar(e,n||b)},parseMarkupLikeGrammar:function(e,n){var t,l,r,s,i,o;if(e.__parsed)return e;if(e=d(e,n),i=e.RegExpID||null,e.RegExpID=null,delete e.RegExpID,o=e.RegExpGroups||{},e.RegExpGroups=null,delete e.RegExpGroups,e.type=null,delete e.type,e.isMarkup=!0,e.comments){if(t=[],e.comments.line)for(l=a(e.comments.line),r=0,s=l.length;s>r;r++)t.push([l[r],null]);e.comments.block&&(l=a(e.comments.block),t.push([l[0],l[1]?l[1]:l[0]])),e.comments=t.length?V(t,i):{start:null,end:null}}else e.comments={start:null,end:null};if(e.blocks=e.blocks?V(e.blocks,i):{start:null,end:null},e.blocks2=e.blocks2?V(e.blocks2,i):{start:null,end:null},e.blocks3=e.blocks3?V(e.blocks3,i):{start:null,end:null},e.blocks4=e.blocks4?V(e.blocks4,i):{start:null,end:null},e.blocks5=e.blocks5?V(e.blocks5,i):{start:null,end:null},e.tags){t=[],l=[];var u=a(e.tags);for(r=0,s=u.length;s>r;r++)t.push([u[r][0],u[r][1]]),l=l.concat(u[r][2]);t=V(t,i),l=$(l,i,o.tags),e.tags={start:t.start,tags:l,end:t.end}}else e.tags={start:null,tags:null,end:null};return e.tags2={start:null,tags:null,end:null},e.tags3={start:null,tags:null,end:null},e.attributes=e.attributes?$(e.attributes,i,o.attributes):null,e.attributes2=e.attributes2?$(e.attributes2,i,o.attributes2):null,e.attributes3=e.attributes3?$(e.attributes3,i,o.attributes3):null,e.doctype=null,e.strings=e.strings?V(e.strings,i):{start:null,end:null},e.strings2=e.strings2?V(e.strings2,i):{start:null,end:null},e.strings3=e.strings3?V(e.strings3,i):{start:null,end:null},e.identifiers=e.identifiers?$(e.identifiers,i,o.identifiers):null,e.identifiers2=e.identifiers2?$(e.identifiers2,i,o.identifiers2):null,e.identifiers3=e.identifiers3?$(e.identifiers3,i,o.identifiers3):null,e.identifiers4=e.identifiers4?$(e.identifiers4,i,o.identifiers4):null,e.identifiers5=e.identifiers5?$(e.identifiers5,i,o.identifiers5):null,e.numbers=e.numbers?$(e.numbers,i,o.numbers):null,e.numbers2=e.numbers2?$(e.numbers2,i,o.numbers2):null,e.numbers3=e.numbers3?$(e.numbers3,i,o.numbers3):null,e.atoms=e.atoms?$(e.atoms,i,o.atoms):null,e.meta=e.meta?$(e.meta,i,o.meta):null,e.defines=e.defines?$(e.defines,i,o.defines):null,e.keywords=e.keywords?$(e.keywords,i,o.keywords):null,e.builtins=e.builtins?$(e.builtins,i,o.builtins):null,e.assignments=e.assignments?$(e.assignments,i,o.assignments):null,e.operators={one:null,two:null,words:null},e.delimiters={one:null,two:null,three:null},e.indent=null,e.hasIndent=!1,e.__parsed=!0,e},parseProgrammingLikeGrammar:function(e,n){var t,l,r,s,i,o;if(e.__parsed)return e;if(e=d(e,n),i=e.RegExpID||null,e.RegExpID=null,delete e.RegExpID,o=e.RegExpGroups||{},e.RegExpGroups=null,delete e.RegExpGroups,e.type=null,delete e.type,e.isMarkup=!1,e.comments){if(t=[],e.comments.line)for(l=a(e.comments.line),r=0,s=l.length;s>r;r++)t.push([l[r],null]);e.comments.block&&(l=a(e.comments.block),t.push([l[0],l[1]?l[1]:l[0]])),e.comments=t.length?V(t,i):{start:null,end:null}}else e.comments={start:null,end:null};return e.blocks=e.blocks?V(e.blocks,i):{start:null,end:null},e.blocks2=e.blocks2?V(e.blocks2,i):{start:null,end:null},e.blocks3=e.blocks3?V(e.blocks3,i):{start:null,end:null},e.blocks4=e.blocks4?V(e.blocks4,i):{start:null,end:null},e.blocks5=e.blocks5?V(e.blocks5,i):{start:null,end:null},e.strings=e.strings?V(e.strings,i):{start:null,end:null},e.strings2=e.strings2?V(e.strings2,i):{start:null,end:null},e.strings3=e.strings3?V(e.strings3,i):{start:null,end:null},e.identifiers=e.identifiers?$(e.identifiers,i,o.identifiers):null,e.identifiers2=e.identifiers2?$(e.identifiers2,i,o.identifiers2):null,e.identifiers3=e.identifiers3?$(e.identifiers3,i,o.identifiers3):null,e.identifiers4=e.identifiers4?$(e.identifiers4,i,o.identifiers4):null,e.identifiers5=e.identifiers5?$(e.identifiers5,i,o.identifiers5):null,e.numbers=e.numbers?$(e.numbers,i,o.numbers):null,e.numbers2=e.numbers2?$(e.numbers2,i,o.numbers2):null,e.numbers3=e.numbers3?$(e.numbers3,i,o.numbers3):null,e.atoms=e.atoms?$(e.atoms,i,o.atoms):null,e.meta=e.meta?$(e.meta,i,o.meta):null,e.defines=e.defines?$(e.defines,i,o.defines):null,e.keywords=e.keywords?$(e.keywords,i,o.keywords):null,e.builtins=e.builtins?$(e.builtins,i,o.builtins):null,e.operators||(e.operators={one:null,two:null,words:null}),e.operators.one=e.operators.one?$(e.operators.one,i,o.operators&&o.operators.one):null,e.operators.two=e.operators.two?$(e.operators.two,i,o.operators&&o.operators.two):null,e.operators.words=e.operators.words?$(e.operators.words,i,o.operators&&o.operators.words):null,e.delimiters||(e.delimiters={one:null,two:null,three:null}),e.delimiters.one=e.delimiters.one?$(e.delimiters.one,i,o.delimiters&&o.delimiters.one):null,e.delimiters.two=e.delimiters.two?$(e.delimiters.two,i,o.delimiters&&o.delimiters.two):null,e.delimiters.three=e.delimiters.three?$(e.delimiters.three,i,o.delimiters&&o.delimiters.three):null,e.indent=null,e.hasIndent=!1,e.__parsed=!0,e},getMode:function(e,n,t){e=Z.parseGrammar(e,n);var l={DEFAULT:t||null};return e.isMarkup?function(n,t){var r=W(e,l,n,t),s=X(r,e,l,n,t),i=Y(l,n,t);return parser={startState:function(e){return l.basecolumn=e||0,{tokenize:null,lastToken:c}},token:s,indent:i}}:function(n,t){var r=Q(e,l,n,t),s=X(r,e,l,n,t),i=Y(l,n,t);return parser={startState:function(e){return l.basecolumn=e||0,{tokenize:null,lastToken:c}},token:s,indent:i}}}};"undefined"!=typeof module&&module.exports?module.exports=Z:"undefined"!=typeof exports?exports=Z:this.CodeMirrorGrammar=Z}).call(this);