/**
*
*   CodeMirrorGrammar
*   Transform a grammar specification in JSON format,
*   into a CodeMirror syntax-highlight parser mode
*
*   https://github.com/foo123/codemirror-grammar
*
**/(function(e,n){var t="0.1";if(!Array.prototype.indexOf){var r=Math.abs;Array.prototype.indexOf=function(e,n){var t,l,i=n?n:0;if(!this)throw new TypeError;if(l=this.length,0===l||i>=l)return-1;for(0>i&&(i=l-r(i)),t=i;l>t;t++)if(this[t]===e)return t;return-1}}var l=/([\-\.\*\+\?\^\$\{\}\(\)\|\[\]\/\\])/g,i=(Array.prototype.slice,Object.prototype.hasOwnProperty),s=Object.prototype.toString,o=function(e){return"number"==typeof e||e instanceof Number},u=function(e){return e&&("string"==typeof e||e instanceof String)},a=function(e){return e&&"[object Array]"==s.call(e)},d=function(e){return e&&"[object Object]"==s.call(e)},m=function(e){return a(e)?e:[e]},f=function(e){if(!d(e)&&!a(e))return e;var n={};for(var t in e)i.call(e,t)&&(n[t]=d(e[t])?f(e[t]):a(e[t])?e[t].slice():e[t]);return n},c=function(e,n){if(!d(n)&&!a(n))return f(e);var t={};for(var r in n)i.call(n,r)&&(t[r]=i.call(e,r)?d(e[r])&&!u(e[r])?c(e[r],n[r]):a(e[r])?e[r].slice():e[r]:f(n[r]));return t},g=function(e,n){if(o(e))return e;var t=n?n.length:0;return t&&n==e.substr(0,t)?new RegExp("^"+e.substr(t)):e},b=function(e){for(var n=0,t=e.length;t>n;n++)e[n]=e[n].replace(l,"\\$1");return new RegExp("^(("+e.join(")|(")+"))\\b")},k=function(e,t,r){r=n===r?!0:r;var l,i=t.length;for(l=0;i>l;l++)if(e.match(t[l],r))return!0;return!1},p=function(e,t,r){r=n===r?!0:r;var l,i,s=t.length;for(l=0;s>l;l++)if(i=e.match(t[l],r))return{key:l,val:u(t[l])?t[l]:i};return!1},h={RegExpID:null,style:{error:"error",comment:"comment",meta:"meta",defines:"def",atom:"atom",keyword:"keyword",builtin:"builtin",operator:"operator",identifier:"variable",identifier2:"variable",identifier3:"variable",identifier4:"variable",identifier5:"variable",number:"number",number2:"number",number3:"number",string:"string",string2:"string",string3:"string",heredoc:"string",delimiter:"meta"},comments:{line:null,block:null},identifiers:null,identifiers2:null,identifiers3:null,identifiers4:null,identifiers5:null,attributes:null,properties:null,numbers:null,numbers2:null,numbers3:null,strings:null,strings2:null,strings3:null,heredoc:null,operators:{one:null,two:null,words:null},atoms:null,meta:null,defines:null,keywords:null,builtins:null,delimiters:{one:null,two:null,three:null},indent:null},v={RegExpID:null,style:{error:"error",comment:"comment",meta:"meta",defines:"def",atom:"atom",keyword:"keyword",builtin:"builtin",attribute:"attribute",tag:"tag",tag2:"tag",tag3:"tag",tag4:"tag",tag5:"tag",identifier:"variable",identifier2:"variable",identifier3:"variable",identifier4:"variable",identifier5:"variable",number:"number",number2:"number",number3:"number",string:"string",string2:"string",string3:"string",cdata:"string",delimiter:"meta"},comments:{line:null,block:null},autoclose:null,tags:null,tags2:null,tags3:null,tags4:null,tags5:null,identifiers:null,identifiers2:null,identifiers3:null,identifiers4:null,identifiers5:null,attributes:null,properties:null,numbers:null,numbers2:null,numbers3:null,strings:null,strings2:null,strings3:null,cdata:null,atoms:null,meta:null,defines:null,keywords:null,builtins:null,delimiters:{one:null,two:null,three:null},indent:null},_=0,y=1,w=2,T=3,z=4,x=5,E=6,I=7,D=8,L=9,A=10,R=11,G=12,O=200,j=210,M=function(e,n,t,r){var l;return l=null==e?function(e,l){return e.skipToEnd(),l.tokenize=r||null,l.__lastToken=n,t}:function(l,i){for(var s=!1;!l.eol();){if(l.match(e)){s=!0;break}l.next()}return s&&(i.tokenize=r||null),i.__lastToken=n,t},l.__type=n,l},S=function(e,n,t,r){var l=function(l,i){for(var s,o=!1,u=!1;null!=(s=l.next());){if(s==e&&!o){u=!0;break}o=!o&&"\\"==s}return(u||!o&&!t)&&(i.tokenize=r||null),i.__lastToken=L,n};return l.__type=L,l},U=function(e,n,t){var r=n.DEFAULT,l=t.multiLineStrings,i=e.style,s=e.heredoc.start||null,u=e.heredoc.end||null,a=e.comments.start||null,d=e.comments.end||null,m=e.strings.start||null,f=e.strings.end||null,c=e.strings2.start||null,g=e.strings2.end||null,b=e.strings3.start||null,h=e.strings3.end||null,v=e.identifiers,L=e.identifiers2,j=e.identifiers3,U=e.identifiers4,F=e.identifiers5,P=e.numbers,C=e.numbers2,N=e.numbers3,$=e.operators,V=e.atoms,q=e.meta,B=e.defines,H=e.keywords,J=e.builtins,K=e.delimiters.hasIndent=e.hasIndent;e.indent;var Q=function(e,n){var t,O;if(e.eatSpace())return n.__lastToken=_,r;if(s&&(O=p(e,s))){var Q=O.key,W=O.val,X=u[Q];return o(X)&&(X=W[X]),n.tokenize=M(X,A,i.heredoc),n.tokenize(e,n)}if(a&&(O=p(e,a))){var Q=O.key,W=O.val,Y=d[Q];return o(Y)&&(Y=W[Y]),n.tokenize=M(Y,E,i.comment),n.tokenize(e,n)}if(P&&k(e,P))return n.__lastToken=R,i.number;if(C&&k(e,C))return n.__lastToken=R,i.number2;if(N&&k(e,N))return n.__lastToken=R,i.number3;if(m&&(O=p(e,m))){var Q=O.key,W=O.val,Z=f[Q];return o(Z)&&(Z=W[Z]),n.tokenize=S(Z,i.string,l),n.tokenize(e,n)}if(c&&(O=p(e,c))){var Q=O.key,W=O.val,Z=g[Q];return o(Z)&&(Z=W[Z]),n.tokenize=S(Z,i.string2,l),n.tokenize(e,n)}if(b&&(O=p(e,b))){var Q=O.key,W=O.val,Z=h[Q];return o(Z)&&(Z=W[Z]),n.tokenize=S(Z,i.string3,l),n.tokenize(e,n)}return K&&(K.three&&e.match(K.three)||K.two&&e.match(K.two))?(n.__lastToken=D,i.delimiter):$&&($.two&&e.match($.two)||$.one&&e.match($.one)||$.words&&e.match($.words))?(n.__lastToken=I,i.operator):K&&K.one&&e.match(K.one)?(n.__lastToken=D,i.delimiter):V&&e.match(V)?(n.__lastToken=T,i.atom):q&&e.match(q)?(n.__lastToken=y,i.meta):B&&e.match(B)?(n.__lastToken=w,i.defines):H&&e.match(H)?(t=e.current(),n.__lastToken=z,i.keyword):J&&e.match(J)?(t=e.current(),n.__lastToken=x,i.builtin):v&&k(e,v)?(n.__lastToken=G,i.identifier):L&&k(e,L)?(n.__lastToken=G,i.identifier2):j&&k(e,j)?(n.__lastToken=G,i.identifier3):U&&k(e,U)?(n.__lastToken=G,i.identifier4):F&&k(e,F)?(n.__lastToken=G,i.identifier5):(e.next(),n.__lastToken=_,r)};return Q.__type=O,Q},F=function(e,n,t,r){t.DEFAULT,t.basecolumn||0,r.indentUnit,n.style,n.hasIndent;var l=function(n,r){var l,i,s;return t.indentInfo=null,null==r.tokenize&&(r.tokenize=e),l=r.tokenize(n,r),i=r.__lastToken,s=n.current(),l};return l.__type=j,l},P=function(e,n,t,r){return t.DEFAULT,t.basecolumn||0,r.indentUnit,n.hasIndent,function(){return CodeMirror.Pass}},C={VERSION:t,parseGrammar:function(e,n){return e.type&&"markup-like"==e.type?C.parseMarkupLikeGrammar(e,n||v):C.parseProgrammingLikeGrammar(e,n||h)},parseMarkupLikeGrammar:function(){return null},parseProgrammingLikeGrammar:function(e,n){var t,r,l,i,s,o,u,d;if(e.__parsed)return e;if(e=c(e,n),o=e.RegExpID||null,e.RegExpID=null,delete e.RegExpID,e.comments){if(u=[],d=[],e.comments.line)for(l=m(e.comments.line),t=0,r=l.length;r>t;t++)u.push(g(l[t],o)),d.push(null);e.comments.block&&(l=m(e.comments.block),i=g(l[0],o),s=l[1]?g(l[1],o):i,u.push(i),d.push(s)),e.comments={start:u,end:d}}else e.comments={start:null,end:null};if(e.heredoc&&e.heredoc.length){for(u=[],d=[],l=e.heredoc,a(l)&&!a(l[0])&&(l=[l]),t=0,r=l.length;r>t;t++)i=g(l[t][0],o),s=l[t][1]?g(l[t][1],o):i,u.push(i),d.push(s);e.heredoc={start:u,end:d}}else e.heredoc={start:null,end:null};if(e.identifiers){for(l=m(e.identifiers),t=0,r=l.length;r>t;t++)l[t]=g(l[t],o);e.identifiers=l}if(e.identifiers2){for(l=m(e.identifiers2),t=0,r=l.length;r>t;t++)l[t]=g(l[t],o);e.identifiers2=l}if(e.identifiers3){for(l=m(e.identifiers3),t=0,r=l.length;r>t;t++)l[t]=g(l[t],o);e.identifiers3=l}if(e.identifiers4){for(l=m(e.identifiers4),t=0,r=l.length;r>t;t++)l[t]=g(l[t],o);e.identifiers4=l}if(e.identifiers5){for(l=m(e.identifiers5),t=0,r=l.length;r>t;t++)l[t]=g(l[t],o);e.identifiers5=l}if(e.numbers){for(l=m(e.numbers),t=0,r=l.length;r>t;t++)l[t]=g(l[t],o);e.numbers=l}if(e.numbers2){for(l=m(e.numbers2),t=0,r=l.length;r>t;t++)l[t]=g(l[t],o);e.numbers2=l}if(e.numbers3){for(l=m(e.numbers3),t=0,r=l.length;r>t;t++)l[t]=g(l[t],o);e.numbers3=l}if(e.strings){for(u=[],d=[],l=m(e.strings),a(l[0])||(l=[l]),t=0,r=l.length;r>t;t++)i=g(l[t][0],o),s=l[t][1]?g(l[t][1],o):i,u.push(i),d.push(s);e.strings={start:u,end:d}}else e.strings={start:null,end:null};if(e.strings2){for(u=[],d=[],l=m(e.strings2),a(l[0])||(l=[l]),t=0,r=l.length;r>t;t++)i=g(l[t][0],o),s=l[t][1]?g(l[t][1],o):i,u.push(i),d.push(s);e.strings2={start:u,end:d}}else e.strings2={start:null,end:null};if(e.strings3){for(u=[],d=[],l=m(e.strings3),a(l[0])||(l=[l]),t=0,r=l.length;r>t;t++)i=g(l[t][0],o),s=l[t][1]?g(l[t][1],o):i,u.push(i),d.push(s);e.strings3={start:u,end:d}}else e.strings3={start:null,end:null};e.atoms=e.atoms?b(m(e.atoms)):null,e.defines=e.defines?b(m(e.defines)):null,e.meta=e.meta?b(m(e.meta)):null,e.keywords=e.keywords?b(m(e.keywords)):null,e.builtins=e.builtins?b(m(e.builtins)):null,e.operators||(e.operators={one:null,two:null,words:null}),e.operators.one=e.operators.one?b(m(e.operators.one)):null,e.operators.two=e.operators.two?b(m(e.operators.two)):null,e.operators.words=e.operators.words?b(m(e.operators.words)):null,e.delimiters||(e.delimiters={one:null,two:null,three:null}),e.delimiters.one=e.delimiters.one?b(m(e.delimiters.one)):null,e.delimiters.two=e.delimiters.two?b(m(e.delimiters.two)):null,e.delimiters.three=e.delimiters.three?b(m(e.delimiters.three)):null;var f=!1;if(e.indent){if(e.indent["block-level"]||(e.indent["block-level"]={keywords:null,delims:null}),e.indent["statement-level"]||(e.indent["statement-level"]={delims:null}),e.indent["block-level"].keywords){l=m(e.indent["block-level"].keywords);var k={};for(t=0,r=l.length;r>t;t++)k[l[t]]=!0;e.indent["block-level"].keywords=k,f=!0}else e.indent["block-level"].keywords={};if(e.indent["block-level"].delims){for(l=m(e.indent["block-level"].delims),u=[],d=[],a(l)&&!a(l[0])&&(l=[l]),t=0,r=l.length;r>t;t++)i=g(l[t][0],o),s=l[t][1]?g(l[t][1],o):i,u.push(i),d.push(s);e.indent["block-level"].delims={start:u,end:d},f=!0}else e.indent["block-level"].delims={start:null,end:null};e.indent["statement-level"].delims?(e.indent["statement-level"].delims=m(e.indent["statement-level"].delims),f=!0):e.indent["statement-level"].delims=[]}else e.indent=null;return e.hasIndent=f,e.__parsed=!0,e},getMode:function(e,n,t){e=C.parseGrammar(e,n);var r={DEFAULT:t||null};return function(n,t){var l=U(e,r,n,t),i=F(l,e,r,n,t),s=P(l,e,r,n,t);return parser={startState:function(e){return r.basecolumn=e,{tokenize:null}},token:i,indent:s}}}};"undefined"!=typeof module&&module.exports?module.exports=C:"undefined"!=typeof exports?exports=C:this.CodeMirrorGrammar=C}).call(this);