/**
*
*   CodeMirrorGrammar
*   Transform a grammar specification in JSON format,
*   into a CodeMirror syntax-highlight parser mode
*
*   https://github.com/foo123/codemirror-grammar
*
**/(function(n,t){var e="0.2",r=2;T_BOOL=4,T_STR=8,T_CHAR=9,T_REGEX=16,T_ARRAY=32,T_OBJ=64,T_NULL=128,T_UNDEF=256,T_UNKNOWN=512,T_PROGRAMMING_LIKE=1,T_MARKUP_LIKE=2,T_DEFAULT=1,T_META=2,T_COMMENT=4,T_DEF=8,T_ATOM=16,T_KEYWORD=32,T_BUILTIN=64,T_STRING=128,T_IDENTIFIER=256,T_NUMBER=512,T_TAG=1024,T_ATTRIBUTE=2048,T_ASSIGNMENT=4096,T_ENDTAG=8192,T_ERROR=16384,T_BLOCK=32768,T_DOCTYPE=65536,T_OP=131072,T_DELIM=262144,T_SIMPLEMATCHER=32,T_CHARMATCHER=33,T_STRMATCHER=34,T_REGEXMATCHER=36,T_EOLMATCHER=40,T_DUMMYMATCHER=48,T_COMPOSITEMATCHER=64,T_BLOCKMATCHER=128,T_TAGMATCHER=256,T_TOKENBASE=200,T_TOKENBASEML=210,T_TOKEN=220;var i=Array.prototype.slice,T=Object.prototype.hasOwnProperty,s=Object.prototype.toString,l=function(n){var e=typeof n,i=s.call(n);return"number"==e||n instanceof Number?r:!0===n||!1===n?T_BOOL:n&&("string"==e||n instanceof String)&&1==n.length?T_CHAR:n&&("string"==e||n instanceof String)?T_STR:n&&("[object RegExp]"==i||n instanceof RegExp)?T_REGEX:n&&("[object Array]"==i||n instanceof Array)?T_ARRAY:n&&"[object Object]"==i?T_OBJ:null===n?T_NULL:t===n?T_UNDEF:T_UNKNOWN},u=function(n){return T_ARRAY==l(n)?n:[n]},o=function(n){return n=u(n),T_ARRAY!=l(n[0])&&(n=[n]),n},a=function(n){var t,e=l(n);if(T_OBJ!=e&&T_ARRAY!=e)return n;var r,i={};for(r in n)T.call(n,r)&&(t=l(n[r]),i[r]=T_OBJ==t?a(n[r]):T_ARRAY==t?n[r].slice():n[r]);return i},_=function(){var n=i.call(arguments),t=n.length;if(1>t)return null;if(2>t)return a(n[0]);var e,r,s,u,o=n.shift(),f=a(o);for(t--,r=0;t>r;r++)if(e=n.shift())for(s in e)T.call(e,s)&&(T.call(o,s)?(u=l(o[s]),T_OBJ&~T_STR&u&&(f[s]=_(o[s],e[s]))):f[s]=a(e[s]));return f},f={RegExpID:null,RegExpGroups:null,TokenOrder:["comments","blocks","blocks2","blocks3","blocks4","blocks5","doctype","atoms","numbers","numbers2","numbers3","strings","strings2","strings3","strings4","strings5","attributes","attributes2","attributes3","assignments","tags","tags2","tags3","keywords","builtins","operators","delimiters","meta","defines","identifiers","identifiers2","identifiers3","identifiers4","identifiers5"],Style:{error:"error",comments:"comment",meta:"meta",defines:"def",atoms:"atom",keywords:"keyword",builtins:"builtin",identifiers:"variable",identifiers2:"variable",identifiers3:"variable",identifiers4:"variable",identifiers5:"variable",tags:"tag",tags2:"tag",tags3:"tag",attributes:"attribute",attributes2:"attribute",attributes3:"attribute",numbers:"number",numbers2:"number",numbers3:"number",strings:"string",strings2:"string",strings3:"string",strings4:"string",strings5:"string",blocks:"string",blocks2:"string",blocks3:"string",blocks4:"string",blocks5:"string",operators:"operator",delimiters:null,assignments:null},Lex:{comments:null,blocks:null,blocks2:null,blocks3:null,blocks4:null,blocks5:null,tags:null,tags2:null,tags3:null,autoclose:null,identifiers:null,identifiers2:null,identifiers3:null,identifiers4:null,identifiers5:null,numbers:null,numbers2:null,numbers3:null,strings:null,strings2:null,strings3:null,strings4:null,strings5:null,attributes:null,attributes2:null,attributes3:null,assignments:null,operators:null,delimiters:null,atoms:null,meta:null,defines:null,keywords:null,builtins:null},Syntax:null,Indentation:null},c=/([\-\.\*\+\?\^\$\{\}\(\)\|\[\]\/\\])/g,E=function(n,t){return t.length-n.length},R=function(n,t){return T_STR&l(t)&&T_STR&l(n)&&t.length&&t.length<=n.length&&t==n.substr(0,t.length)},g=function(n,t){if(!n||r==l(n))return n;var e=t?t.length||0:0;return e&&t==n.substr(0,e)?new RegExp("^("+n.substr(e)+")"):n},A=function(n){for(var t=0,e=n.length;e>t;t++)n[t]=n[t].replace(c,"\\$1");return new RegExp("^(("+n.sort(E).join(")|(")+"))\\b")},m=function(n,t,e){var r;e=e||0,this.type=n||T_STRMATCHER,T_CHARMATCHER==this.type?(r=t.length,this.match=function(n,i){i=!1!==i;var T=t,s=ch=n.string.charAt(n.pos)||"";return T==s?(i&&(n.pos+=r),{key:e,val:ch}):!1}):T_STRMATCHER==this.type?(r=t.length,this.match=function(n,i){i=!1!==i;var T=t,s=str=n.string.substr(n.pos,r);return T==s?(i&&(n.pos+=r),{key:e,val:str}):!1}):this.match=T_REGEXMATCHER==this.type?function(n,r){r=!1!==r;var i=n.string.slice(n.pos).match(t);return!i||i.index>0?!1:(r&&(n.pos+=i[0].length),{key:e,val:i})}:T_EOLMATCHER==this.type?function(n,t){return!1!==t&&(n.pos=n.string.length),{key:e,val:""}}:T_DUMMYMATCHER==this.type?function(){return{key:e,val:t}}:function(){return!1}},h=function(n,t){var e=n.length;t=!1!==t,this.type=T_COMPOSITEMATCHER,this.match=0>=e?function(){return!1}:1==e?n[0].match:t?function(t,r){var i,T;for(i=0;e>i;i++)if(T=n[i].match(t,r))return{key:i,val:T.val};return!1}:function(t,r){var i,T;for(i=0;e>i;i++)if(T=n[i].match(t,r))return T;return!1}},b=function(n,t){var e,i,T=new h(n,!1);this.type=T_BLOCKMATCHER,this.match=function(n,s){return e=T.match(n,s),e?(i=t[e.key],r==l(i)&&(i=new m(T_STRMATCHER,e.val[i+1])),i):!1}},k=function(n,t,e){var i,T,s=new h(n,!1),u="";this.type=T_TAGMATCHER,this.match=function(n,o){return i=s.match(n,o),i?(nameMatcher=t[i.key],r==l(nameMatcher)?u=i.val[nameMatcher+1]:(u=nameMatcher.match(i.val),u=u?u.val:""),T=e[i.key],r==l(T)&&(T=new m(T_STRMATCHER,i.val[T+1])),[T,u]):!1}},p=function(n,t){t=t||0;var e=l(n);return r==e?n:T_BOOL==e?new m(T_DUMMYMATCHER,n,t):T_NULL==e?new m(T_EOLMATCHER,n,t):T_CHAR==e?new m(T_CHARMATCHER,n,t):T_STR==e?new m(T_STRMATCHER,n,t):T_REGEX==e?new m(T_REGEXMATCHER,n,t):n},M=function(n,t,e){var r,i,T,s,o=!1,a=!1;if(r=u(n),T=r.length,e)for(s=(T>>1)+1,i=0;s>=i;i++){if(T_ARRAY==l(r[i])||T_ARRAY==l(r[T-1-i])){o=!0;break}if(R(r[i],t)||R(r[T-1-i],t)){a=!0;break}}if(!e||o||a){for(i=0;T>i;i++)r[i]=T_ARRAY==l(r[i])?M(r[i],t,e):p(g(r[i],t),i);return r.length>1?new h(r):r[0]}return p(A(r))},d=function(n,t){var e,r,i,T,s,l,u;for(T=[],s=[],e=o(n),r=0,i=e.length;i>r;r++)l=p(g(e[r][0],t),r),u=e[r].length>1?p(g(e[r][1],t),r):l,T.push(l),s.push(u);return new b(T,s)},I=function(n,t,e){var r,i,T,s,l,u,a,_,f;for(s=[],l=[],u=[],r=o(n),i=0,T=r.length;T>i;i++)a=p(g(r[i][0],t),i),_=r[i].length>2?p(g(r[i][2],t),i):a,f=r[i].length>1?M(g(r[i][1],t,e),i):a,s.push(a),l.push(f),u.push(_);return new k(s,l,u)},O=function(n,t,e,r){var i=function(i,T){if(n.match(i))return T.tokenize=r||null,T.lastToken=t,e;for(var s=!1;!i.eol();)if(i.next(),n.match(i)){s=!0;break}return s&&(T.tokenize=r||null),T.lastToken=t,e};return i.type=t|T_BLOCK,i},C=function(n,t,e,r,i){var T=function(T,s){for(var l=!1,u="",o=!1;!T.eol();){if(!l&&n.match(T)){o=!0;break}u=T.next(),l=!l&&"\\"==u}return(o||!l&&!r)&&(s.tokenize=i||null),s.lastToken=t,e};return T.type=t|T_STRING,T},L=function(n,t,e,r,i){var T=n[0];n[1];var s=function(n,l){var u;return u=r[0]||null,u&&T===u[0]?(r.shift(),l.lastToken=t|T_ENDTAG):(r.unshift([T,s]),l.lastToken=t),l.tokenize=i||null,e};return s.type=t|T_TAG,s},v=function(n,t){var e=t.DEFAULT,r=n.TokenOrder||[],i=r.length;n.hasIndent,n.indent;var T=function(n,T){var s,l,u,o,a,_,f=t.conf.multiLineStrings;if(n.eatSpace())return T.lastToken=T_DEFAULT,e;for(s=0;i>s;s++)if(l=r[s]){if(u=l[0],o=l[1],a=l[2],(T_COMMENT|T_BLOCK)&o&&(_=u.match(n)))return T.tokenize=O(_,o,a),T.tokenize(n,T);if(T_STRING&o&&(_=u.match(n)))return T.tokenize=C(_,o,a,f),T.tokenize(n,T);if(u.match(n))return T.lastToken=o,a}return n.next(),T.lastToken=T_DEFAULT,e};return T.type=T_TOKENBASE,T},N=function(n,t){var e=t.DEFAULT,r=[],i=n.TokenOrder||[],T=i.length;return n.hasIndent,n.indent,function(n,s){var l,u,o,a,_,f,c=t.conf.multiLineStrings,E=null;if(n.eatSpace())return s.lastToken=T_DEFAULT,e;if(E=r[0]||null,E&&E[0].match(n))return s.tokenize=E[1],s.tokenize(n,s);for(l=0;T>l;l++)if(u=i[l]){if(o=u[0],a=u[1],_=u[2],(T_COMMENT|T_BLOCK)&a&&(f=o.match(n)))return s.tokenize=O(f,a,_),s.tokenize(n,s);if(T_TAG&a&&(f=o.match(n)))return s.tokenize=L(f,a,_,r),s.tokenize(n,s);if(T_STRING&a&&(f=o.match(n)))return s.tokenize=C(f,a,_,c),s.tokenize(n,s);if(r.length&&T_ATTRIBUTE&a&&o.match(n))return s.lastToken=a,_;if(!(T_ATTRIBUTE&a)&&o.match(n))return s.lastToken=a,_}return n.next(),s.lastToken=T_DEFAULT,e}},S=function(n,t,e){e.DEFAULT,t.hasIndent;var r=function(t,r){e.conf.multiLineStrings,e.basecolumn||0,e.conf.indentUnit;var i;return e.indentInfo=null,null==r.tokenize&&(r.tokenize=n),i=r.tokenize(t,r)};return r.type=T_TOKEN,r},y=function(n){return n.DEFAULT,function(){return n.basecolumn||0,n.conf.indentUnit,CodeMirror.Pass}},G={VERSION:e,extendGrammar:_,parseGrammar:function(n,t){var e,r,i,T,s,l,u,o,a,c,E,R,g;if(n.__parsed)return n;for(n=_(n,t,f),e=n.RegExpID||null,n.RegExpID=null,delete n.RegExpID,r=n.RegExpGroups||{},n.RegExpGroups=null,delete n.RegExpGroups,n.type=n.type&&"markup-like"==n.type?T_MARKUP_LIKE:T_PROGRAMMING_LIKE,i=n.TokenOrder||[],T=i.length,s=[],l=n.Style||{},u=n.Lex||{},g={TAG:{tags:T_TAG,tags2:T_TAG,tags3:T_TAG},DOCTYPE:{doctype:T_DOCTYPE},BLOCK:{comments:T_COMMENT,blocks:T_BLOCK,blocks2:T_BLOCK,blocks3:T_BLOCK,blocks4:T_BLOCK,blocks5:T_BLOCK},STRING:{strings:T_STRING,strings2:T_STRING,strings3:T_STRING,strings4:T_STRING,strings5:T_STRING},SIMPLE:{identifiers:T_IDENTIFIER,identifiers2:T_IDENTIFIER,identifiers3:T_IDENTIFIER,identifiers4:T_IDENTIFIER,identifiers5:T_IDENTIFIER,numbers:T_NUMBER,numbers2:T_NUMBER,numbers3:T_NUMBER,attributes:T_ATTRIBUTE,attributes2:T_ATTRIBUTE,attributes3:T_ATTRIBUTE,keywords:T_KEYWORD,builtins:T_BUILTIN,atoms:T_ATOM,meta:T_META,defines:T_DEF,operators:T_OP,delimiters:T_DELIM,assignments:T_ASSIGNMENT}},o=0;T>o;o++)if(a=i[o],u[a]){if(c=null,a in g.BLOCK)c=d(u[a],e)||null,E=g.BLOCK[a],R=l[a]||null;else if(a in g.STRING)c=d(u[a],e)||null,E=g.STRING[a],R=l[a]||null;else if(a in g.TAG)c=I(u[a],e,r[a])||null,E=g.TAG[a],R=l[a]||null;else{if(a in g.DOCTYPE)continue;a in g.SIMPLE&&(c=M(u[a],e,r[a])||null,E=g.SIMPLE[a],R=l[a]||null)}c?(u[a]=c,s.push([c,E,R])):u[a]=null}return n.TokenOrder=s,n.Style=l,n.Lex=u,n.Syntax=null,n.Indentation=null,n.hasIndent=!1,n.__parsed=!0,n},getMode:function(n,t,e){n=G.parseGrammar(n,t);var r,i,T,s={DEFAULT:e||null};return r=T_MARKUP_LIKE==n.type?N(n,s):v(n,s),i=S(r,n,s),T=y(s),function(n,t){return s.conf=n,s.parserConf=t,{startState:function(n){return s.basecolumn=n||0,{tokenize:null,lastToken:T_DEFAULT}},token:i,indent:T}}}};"undefined"!=typeof module&&module.exports?module.exports=G:"undefined"!=typeof exports?exports=G:this.CodeMirrorGrammar=G}).call(this);