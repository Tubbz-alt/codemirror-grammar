/**
*
*   CodeMirrorGrammar
*   Transform a grammar specification in JSON format,
*   into a CodeMirror syntax-highlight parser mode
*
*   https://github.com/foo123/codemirror-grammar
*
**/(function(){var e="0.1",n=(Array.prototype.slice,Object.prototype.hasOwnProperty),i=Object.prototype.toString,r=function(e){return"number"==typeof e||e instanceof Number},l=function(e){return e&&("string"==typeof e||e instanceof String)&&1==e.length},s=function(e){return e&&("string"==typeof e||e instanceof String)},u=function(e){return e&&("[object RegExp]"==i.call(e)||e instanceof RegExp)},o=function(e){return e&&"[object Array]"==i.call(e)},a=function(e){return e&&"[object Object]"==i.call(e)},f=function(e){return o(e)?e:[e]},c=function(e){if(!a(e)&&!o(e))return e;var t={};for(var i in e)n.call(e,i)&&(t[i]=a(e[i])?c(e[i]):o(e[i])?e[i].slice():e[i]);return t},m=function(e,t){if(!a(t)&&!o(t))return c(e);var i={};for(var r in t)n.call(t,r)&&(i[r]=n.call(e,r)?a(e[r])&&!s(e[r])?m(e[r],t[r]):o(e[r])?e[r].slice():e[r]:c(t[r]));return i},b={RegExpID:null,RegExpGroups:null,TokenOrder:["comments","blocks","blocks2","blocks3","blocks4","blocks5","numbers","numbers2","numbers3","strings","strings2","strings3","keywords","builtins","operators","delimiters","atoms","meta","defines","identifiers","identifiers2","identifiers3","identifiers4","identifiers5"],Style:{error:"error",comment:"comment",meta:"meta",defines:"def",atom:"atom",keyword:"keyword",builtin:"builtin",operator:"operator",identifier:"variable",identifier2:"variable",identifier3:"variable",identifier4:"variable",identifier5:"variable",number:"number",number2:"number",number3:"number",string:"string",string2:"string",string3:"string",block:"string",block2:"string",block3:"string",block4:"string",block5:"string",delimiter:"meta"},comments:{line:null,block:null},blocks:null,blocks2:null,blocks3:null,blocks4:null,blocks5:null,identifiers:null,identifiers2:null,identifiers3:null,identifiers4:null,identifiers5:null,numbers:null,numbers2:null,numbers3:null,strings:null,strings2:null,strings3:null,operators:null,delimiters:null,atoms:null,meta:null,defines:null,keywords:null,builtins:null,indent:null},d={RegExpID:null,RegExpGroups:null,TokenOrder:["comments","blocks","blocks2","blocks3","blocks4","blocks5","doctype","atoms","numbers","numbers2","numbers3","strings","strings2","strings3","meta","tags","tags2","tags3","defines","keywords","builtins","identifiers","identifiers2","identifiers3","identifiers4","identifiers5"],Style:{error:"error",comment:"comment",meta:"meta",defines:"def",atom:"atom",keyword:"keyword",builtin:"builtin",operator:"operator",assignment:null,tag:"tag",tag2:"tag",tag3:"tag",attribute:"attribute",attribute2:"attribute",attribute3:"attribute",identifier:"variable",identifier2:"variable",identifier3:"variable",identifier4:"variable",identifier5:"variable",number:"number",number2:"number",number3:"number",string:"string",string2:"string",string3:"string",block:"string",block2:"string",block3:"string",block4:"string",block5:"string",delimiter:"meta"},comments:{line:null,block:null},blocks:null,blocks2:null,blocks3:null,blocks4:null,blocks5:null,tags:null,tags2:null,tags3:null,autoclose:null,attributes:null,attributes2:null,attributes3:null,identifiers:null,identifiers2:null,identifiers3:null,identifiers4:null,identifiers5:null,numbers:null,numbers2:null,numbers3:null,strings:null,strings2:null,strings3:null,atoms:null,meta:null,defines:null,keywords:null,builtins:null,assignments:null,operators:null,delimiters:null,indent:null},k=1,g=2,p=4,h=8,y=16,v=32,T=64,x=128,E=256,w=512,z=1024,R=2048,S=4096,I=8192,G=16384,D=32768,L=65536,O=131072,A=262144,_=1,U=2,j=33,N=34,F=36,M=T_LINEMATCHER=40,P=64,C=128,$=200,H=220,V=/([\-\.\*\+\?\^\$\{\}\(\)\|\[\]\/\\])/g,q=function(e,n){return e.length-n.length},B=function(e,n){return s(n)&&s(e)&&n.length&&n.length<=e.length&&n==e.substr(0,n.length)},J=function(e,n){if(!e||r(e))return e;var t=n?n.length||0:0;return t&&n==e.substr(0,t)?new RegExp("^("+e.substr(t)+")"):e},K=function(e){for(var n=0,t=e.length;t>n;n++)e[n]=e[n].replace(V,"\\$1");return new RegExp("^(("+e.sort(q).join(")|(")+"))\\b")},Q=function(e,n,t){var i;t=t||0,this.type=e||N,j==this.type?this.match=function(e,i){i=!1!==i;var r=n,l=ch=e.string.charAt(e.pos)||"";return r==l?(i&&(e.pos+=1),{key:t,val:ch}):!1}:N==this.type?(i=n.length,this.match=function(e,r){r=!1!==r;var l=n,s=str=e.string.substr(e.pos,i);return l==s?(r&&(e.pos+=i),{key:t,val:str}):!1}):this.match=F==this.type?function(e,i){i=!1!==i;var r=e.string.slice(e.pos).match(n);return!r||r.index>0?!1:(i&&(e.pos+=r[0].length),{key:t,val:r})}:M==this.type?function(e,n){return!1!==n&&e.skipToEnd(),{key:t,val:""}}:function(){return!1}},W=function(e,n){var t=e.length;n=!1!==n,this.type=P,this.match=0>=t?function(){return!1}:1==t?e[0].match:n?function(n,i){var r,l;for(r=0;t>r;r++)if(l=e[r].match(n,i))return{key:r,val:l.val};return!1}:function(n,i){var r,l;for(r=0;t>r;r++)if(l=e[r].match(n,i))return l;return!1}},X=function(e,n){var t,i,l=new W(e,!1);this.type=C,this.match=function(e,s){return t=l.match(e,s),t?(i=n[t.key],r(i)&&(i=Y(t.val[i+1])),i):!1}},Y=function(e,n){return n=n||0,r(e)?e:l(e)?new Q(j,e,n):s(e)?new Q(N,e,n):u(e)?new Q(F,e,n):null==e?new Q(M,e,n):e},Z=function(e,n,t){var i,r,l,s,u=!1,a=!1;if(i=f(e),l=i.length,s=(l>>1)+1,t)for(r=0;s>=r;r++){if(o(i[r])||o(i[l-1-r])){u=!0;break}if(B(i[r],n)||B(i[l-1-r],n)){a=!0;break}}if(!t||u||a){for(r=0;l>r;r++)i[r]=o(i[r])?Z(i[r],n,t):Y(J(i[r],n),r);return new W(i)}return new W([Y(K(i))])},en=function(e,n){var t,i,r,l,s,u,a;for(l=[],s=[],t=f(e),o(t[0])||(t=[t]),i=0,r=t.length;r>i;i++)u=Y(J(t[i][0],n),i),a=t[i].length>1?Y(J(t[i][1],n),i):u,l.push(u),s.push(a);return new X(l,s)},nn=function(e,n,t,i){var r=function(r,l){for(var s=!1;!r.eol();){if(e.match(r)){s=!0;break}r.next()}return s&&(l.tokenize=i||null),l.lastToken=n,t};return r.type=n|D,r},tn=function(e,n,t,i){var r=function(r,l){for(var s,u=!1,o=!1;!r.eol();){if(e.match(r)&&!u){o=!0;break}s=r.next(),u=!u&&"\\"==s}return(o||!u&&!t)&&(l.tokenize=i||null),l.lastToken=x,n};return r.type=x,r},rn=function(e,n,t){var i=n.DEFAULT,r=n.style,l=n.tagNames,s=n.attributes,u=n.assignments,o=n.strings,a=!1,f=function(n,c){var m,b;return c.lastToken,!a&&l&&(m=l.match(n))?(c.lastToken=z,a=!0,r.tag):a?n.eatSpace()?(c.lastToken=k,i):e.match(n)?(c.tokenize=t||null,c.lastToken=I,r.tag):s&&s.match(n)?(c.lastToken=R,r.attribute):u&&u.match(n)?(c.lastToken=S,i):o&&(b=o.match(n))?(c.tokenize=tn(b,r.string,!1,f),c.tokenize(n,c)):(c.lastToken=k,i):(c.lastToken=G,r.error)};return f.type=z,f},ln=function(e,n){var t=function(t,i){for(var r,l=!1,s=1;!l&&(r=t.next(),null!=r);)if("<"!=r)if(">"!=r);else{if(1==s){i.tokenize=n||null;break}s--}else s++;return i.lastToken=L,e};return t.type=L,t},sn=function(e,n,t){var i=n.DEFAULT,r=t.multiLineStrings,l=(e.Style||{},e.TokenOrder||[]),s=l.length;e.hasIndent,e.indent;var u=function(e,n){var t,u,o,a,f,c;if(e.eatSpace())return n.lastToken=k,i;for(t=0;s>t;t++)if(u=l[t]){if(o=u[0],a=u[1],f=u[2],(p|D)&a&&(c=o.match(e)))return n.tokenize=nn(c,a,f),n.tokenize(e,n);if(x&a&&(c=o.match(e)))return n.tokenize=tn(c,f,r),n.tokenize(e,n);if(o.match(e))return n.lastToken=a,f}return e.next(),n.lastToken=k,i};return u.type=$,u},un=function(e,n){var t=n.DEFAULT,i=e.Style||{},r=e.TokenOrder||[],l=r.length,s=e.tagNames||null,u=e.attributes,o=(e.attributes2,e.attributes3,e.assignments);return e.hasIndent,e.indent,function(a,f){var c,m,b,d,g,h;if(a.eatSpace())return f.lastToken=k,t;for(c=0;l>c;c++)if(m=r[c]){if(b=m[0],d=m[1],g=m[2],(p|D)&d&&(h=b.match(a)))return f.tokenize=nn(h,d,g),f.tokenize(a,f);if(L&d&&b.match(a))return f.tokenize=ln(g),f.tokenize(a,f);if(z&d&&(h=b.match(a)))return n.style=i,n.tagNames=s,n.attributes=u,n.assignments=o,n.strings=e.strings,f.tokenize=rn(h,n),f.tokenize(a,f);if(x&d&&(h=b.match(a)))return f.tokenize=tn(h,g,multiLineStrings),f.tokenize(a,f);if(b.match(a))return f.lastToken=d,g}return a.next(),f.lastToken=k,t}},on=function(e,n,t,i){t.DEFAULT,t.basecolumn||0,i.indentUnit,n.hasIndent;var r=function(n,i){var r;return t.indentInfo=null,null==i.tokenize&&(i.tokenize=e),r=i.tokenize(n,i)};return r.type=H,r},an=function(e,n){return e.DEFAULT,e.basecolumn||0,n.indentUnit,function(){return CodeMirror.Pass}},fn={VERSION:e,parseGrammar:function(e,n){return e.type&&"markup-like"==e.type?fn.parseMarkupLikeGrammar(e,n||d):fn.parseProgrammingLikeGrammar(e,n||b)},parseMarkupLikeGrammar:function(e,n){var i,r,l,s,u,o,a,c,b,d,k,R,S,I=[];if(e.__parsed)return e;for(e=m(e,n),u=e.RegExpID||null,e.RegExpID=null,delete e.RegExpID,o=e.RegExpGroups||{},e.RegExpGroups=null,delete e.RegExpGroups,e.type=U,a=e.TokenOrder||[],c=a.length,b=e.Style||{},t=0;c>t;t++)if(d=a[t],e[d]){if(k=null,"comments"==d){if(i=[],e.comments.line)for(r=f(e.comments.line),l=0,s=r.length;s>l;l++)i.push([r[l],null]);e.comments.block&&(r=f(e.comments.block),i.push([r[0],r[1]?r[1]:r[0]])),k=i.length?en(i,u):null,R=p,S=b.comment}else if("blocks"==d)k=en(e.blocks,u)||null,R=D,S=b.block;else if("blocks2"==d)k=en(e.blocks2,u)||null,R=D,S=b.block2;else if("blocks3"==d)k=en(e.blocks3,u)||null,R=D,S=b.block3;else if("blocks4"==d)k=en(e.blocks4,u)||null,R=D,S=b.block4;else if("blocks5"==d)k=en(e.blocks5,u)||null,R=D,S=b.block5;else if("tags"==d){i=[],r=[];var G=f(e.tags);for(l=0,s=G.length;s>l;l++)i.push([G[l][0],G[l][1]]),r=r.concat(G[l][2]);i=en(i,u)||null,r=Z(r,u,o.tags)||null,k=i,R=z,S=b.tag,e.tagNames=r}else{if("tags2"==d)continue;if("tags3"==d)continue;if("doctype"==d)continue;if("strings"==d)k=en(e.strings,u)||null,R=x,S=b.string;else if("strings2"==d)k=en(e.strings2,u)||null,R=x,S=b.string2;else if("strings3"==d)k=en(e.strings3,u)||null,R=x,S=b.string3;else if("numbers"==d)k=Z(e.numbers,u,o.numbers)||null,R=w,S=b.number;else if("numbers2"==d)k=Z(e.numbers2,u,o.numbers2)||null,R=w,S=b.number2;else if("numbers3"==d)k=Z(e.numbers3,u,o.numbers3)||null,R=w,S=b.number3;else if("identifiers"==d)k=Z(e.identifiers,u,o.identifiers)||null,R=E,S=b.identifier;else if("identifiers2"==d)k=Z(e.identifiers2,u,o.identifiers2)||null,R=E,S=b.identifier2;else if("identifiers3"==d)k=Z(e.identifiers3,u,o.identifiers3)||null,R=E,S=b.identifier3;else if("identifiers4"==d)k=Z(e.identifiers4,u,o.identifiers4)||null,R=E,S=b.identifier4;else if("identifiers5"==d)k=Z(e.identifiers5,u,o.identifiers5)||null,R=E,S=b.identifier5;else if("atoms"==d)k=Z(e.atoms,u,o.atoms)||null,R=y,S=b.atom;else if("meta"==d)k=Z(e.meta,u,o.meta)||null,R=g,S=b.meta;else if("defines"==d)k=Z(e.defines,u,o.defines)||null,R=h,S=b.defines;else if("keywords"==d)k=Z(e.keywords,u,o.keywords)||null,R=v,S=b.keyword;else if("builtins"==d)k=Z(e.builtins,u,o.builtins)||null,R=T,S=b.builtin;else{if("operators"==d)continue;if("delimiters"==d)continue}}k?(e[d]=k,I.push([k,R,S])):e[d]=null}return e.TokenOrder=I,e.attributes=e.attributes?Z(e.attributes,u,o.attributes):null,e.attributes2=e.attributes2?Z(e.attributes2,u,o.attributes2):null,e.attributes3=e.attributes3?Z(e.attributes3,u,o.attributes3):null,e.assignments=e.assignments?Z(e.assignments,u,o.assignments):null,e.indent=null,e.hasIndent=!1,e.__parsed=!0,e},parseProgrammingLikeGrammar:function(e,n){var i,r,l,s,u,o,a,c,b,d,k,z,R,S=[];if(e.__parsed)return e;for(e=m(e,n),u=e.RegExpID||null,e.RegExpID=null,delete e.RegExpID,o=e.RegExpGroups||{},e.RegExpGroups=null,delete e.RegExpGroups,e.type=_,a=e.TokenOrder||[],c=a.length,b=e.Style||{},t=0;c>t;t++)if(d=a[t],e[d]){if(k=null,"comments"==d){if(i=[],e.comments.line)for(r=f(e.comments.line),l=0,s=r.length;s>l;l++)i.push([r[l],null]);e.comments.block&&(r=f(e.comments.block),i.push([r[0],r[1]?r[1]:r[0]])),k=i.length?en(i,u):null,z=p,R=b.comment}else"blocks"==d?(k=en(e.blocks,u)||null,z=D,R=b.block):"blocks2"==d?(k=en(e.blocks2,u)||null,z=D,R=b.block2):"blocks3"==d?(k=en(e.blocks3,u)||null,z=D,R=b.block3):"blocks4"==d?(k=en(e.blocks4,u)||null,z=D,R=b.block4):"blocks5"==d?(k=en(e.blocks5,u)||null,z=D,R=b.block5):"strings"==d?(k=en(e.strings,u)||null,z=x,R=b.string):"strings2"==d?(k=en(e.strings2,u)||null,z=x,R=b.string2):"strings3"==d?(k=en(e.strings3,u)||null,z=x,R=b.string3):"numbers"==d?(k=Z(e.numbers,u,o.numbers)||null,z=w,R=b.number):"numbers2"==d?(k=Z(e.numbers2,u,o.numbers2)||null,z=w,R=b.number2):"numbers3"==d?(k=Z(e.numbers3,u,o.numbers3)||null,z=w,R=b.number3):"identifiers"==d?(k=Z(e.identifiers,u,o.identifiers)||null,z=E,R=b.identifier):"identifiers2"==d?(k=Z(e.identifiers2,u,o.identifiers2)||null,z=E,R=b.identifier2):"identifiers3"==d?(k=Z(e.identifiers3,u,o.identifiers3)||null,z=E,R=b.identifier3):"identifiers4"==d?(k=Z(e.identifiers4,u,o.identifiers4)||null,z=E,R=b.identifier4):"identifiers5"==d?(k=Z(e.identifiers5,u,o.identifiers5)||null,z=E,R=b.identifier5):"atoms"==d?(k=Z(e.atoms,u,o.atoms)||null,z=y,R=b.atom):"meta"==d?(k=Z(e.meta,u,o.meta)||null,z=g,R=b.meta):"defines"==d?(k=Z(e.defines,u,o.defines)||null,z=h,R=b.defines):"keywords"==d?(k=Z(e.keywords,u,o.keywords)||null,z=v,R=b.keyword):"builtins"==d?(k=Z(e.builtins,u,o.builtins)||null,z=T,R=b.builtin):"operators"==d?(k=Z(e.operators,u,o.operators)||null,z=O,R=b.operator):"delimiters"==d&&(k=Z(e.delimiters,u,o.delimiters)||null,z=A,R=b.delimiter);k?(e[d]=k,S.push([k,z,R])):e[d]=null}return e.TokenOrder=S,e.indent=null,e.hasIndent=!1,e.__parsed=!0,e},getMode:function(e,n,t){e=fn.parseGrammar(e,n);var i={DEFAULT:t||null};return U==e.type?function(n,t){var r=un(e,i,n,t),l=on(r,e,i,n,t),s=an(i,n,t);return parser={startState:function(e){return i.basecolumn=e||0,{tokenize:null,lastToken:k}},token:l,indent:s}}:function(n,t){var r=sn(e,i,n,t),l=on(r,e,i,n,t),s=an(i,n,t);return parser={startState:function(e){return i.basecolumn=e||0,{tokenize:null,lastToken:k}},token:l,indent:s}}}};"undefined"!=typeof module&&module.exports?module.exports=fn:"undefined"!=typeof exports?exports=fn:this.CodeMirrorGrammar=fn}).call(this);