/**
*
*   CodeMirrorGrammar
*   Transform a grammar specification in JSON format,
*   into a CodeMirror syntax-highlight parser mode
*
*   https://github.com/foo123/codemirror-grammar
*
**/(function(){var n="0.1",e=(Array.prototype.slice,Object.prototype.hasOwnProperty),i=Object.prototype.toString,r=function(n,e){return e===n},l=function(n){return"number"==typeof n||n instanceof Number},s=function(n){return!0===n||!1===n},u=function(n){return n&&("string"==typeof n||n instanceof String)&&1==n.length},o=function(n){return n&&("string"==typeof n||n instanceof String)},a=function(n){return n&&("[object RegExp]"==i.call(n)||n instanceof RegExp)},f=function(n){return n&&"[object Array]"==i.call(n)},c=function(n){return n&&"[object Object]"==i.call(n)},m=function(n){return f(n)?n:[n]},b=function(n){if(!c(n)&&!f(n))return n;var t={};for(var i in n)e.call(n,i)&&(t[i]=c(n[i])?b(n[i]):f(n[i])?n[i].slice():n[i]);return t},g=function(n,t){if(!c(t)&&!f(t))return b(n);var i={};for(var r in t)e.call(t,r)&&(i[r]=e.call(n,r)?c(n[r])&&!o(n[r])?g(n[r],t[r]):f(n[r])?n[r].slice():n[r]:b(t[r]));return i},d={RegExpID:null,RegExpGroups:null,TokenOrder:["comments","blocks","blocks2","blocks3","blocks4","blocks5","numbers","numbers2","numbers3","strings","strings2","strings3","strings4","strings5","keywords","builtins","operators","delimiters","atoms","meta","defines","identifiers","identifiers2","identifiers3","identifiers4","identifiers5"],Style:{error:"error",comment:"comment",meta:"meta",defines:"def",atom:"atom",keyword:"keyword",builtin:"builtin",operator:"operator",identifier:"variable",identifier2:"variable",identifier3:"variable",identifier4:"variable",identifier5:"variable",number:"number",number2:"number",number3:"number",string:"string",string2:"string",string3:"string",string4:"string",string5:"string",block:"string",block2:"string",block3:"string",block4:"string",block5:"string",delimiter:"meta"},comments:{line:null,block:null},blocks:null,blocks2:null,blocks3:null,blocks4:null,blocks5:null,identifiers:null,identifiers2:null,identifiers3:null,identifiers4:null,identifiers5:null,numbers:null,numbers2:null,numbers3:null,strings:null,strings2:null,strings3:null,strings4:null,strings5:null,operators:null,delimiters:null,atoms:null,meta:null,defines:null,keywords:null,builtins:null,indent:null},k={RegExpID:null,RegExpGroups:null,TokenOrder:["comments","blocks","blocks2","blocks3","blocks4","blocks5","doctype","atoms","numbers","numbers2","numbers3","strings","strings2","strings3","strings4","strings5","meta","attributes","attributes2","attributes3","assignments","tags","tags2","tags3","defines","keywords","builtins","identifiers","identifiers2","identifiers3","identifiers4","identifiers5"],Style:{error:"error",comment:"comment",meta:"meta",defines:"def",atom:"atom",keyword:"keyword",builtin:"builtin",operator:"operator",assignment:null,tag:"tag",tag2:"tag",tag3:"tag",attribute:"attribute",attribute2:"attribute",attribute3:"attribute",identifier:"variable",identifier2:"variable",identifier3:"variable",identifier4:"variable",identifier5:"variable",number:"number",number2:"number",number3:"number",string:"string",string2:"string",string3:"string",string4:"string",string5:"string",block:"string",block2:"string",block3:"string",block4:"string",block5:"string",delimiter:"meta"},comments:{line:null,block:null},blocks:null,blocks2:null,blocks3:null,blocks4:null,blocks5:null,tags:null,tags2:null,tags3:null,autoclose:null,attributes:null,attributes2:null,attributes3:null,identifiers:null,identifiers2:null,identifiers3:null,identifiers4:null,identifiers5:null,numbers:null,numbers2:null,numbers3:null,strings:null,strings2:null,strings3:null,strings4:null,strings5:null,atoms:null,meta:null,defines:null,keywords:null,builtins:null,assignments:null,operators:null,delimiters:null,indent:null},p=1,h=2,y=4,v=8,E=16,T=32,x=64,w=128,z=256,R=512,I=1024,D=2048,O=4096,S=8192,G=32768,L=65536,A=131072,_=262144,F=1,M=2,N=33,j=34,U=36,C=(T_ENDOFLINEMATCHER=40,48),P=64,H=128,$=200,V=220,q=/([\-\.\*\+\?\^\$\{\}\(\)\|\[\]\/\\])/g,B=function(n,e){return e.length-n.length},J=function(n,e){return o(e)&&o(n)&&e.length&&e.length<=n.length&&e==n.substr(0,e.length)},K=function(n,e){if(!n||l(n))return n;var t=e?e.length||0:0;return t&&e==n.substr(0,t)?new RegExp("^("+n.substr(t)+")"):n},Q=function(n){for(var e=0,t=n.length;t>e;e++)n[e]=n[e].replace(q,"\\$1");return new RegExp("^(("+n.sort(B).join(")|(")+"))\\b")},W=function(n,e,t){var i;t=t||0,this.type=n||j,N==this.type?this.match=function(n,i){i=!1!==i;var r=e,l=ch=n.string.charAt(n.pos)||"";return r==l?(i&&(n.pos+=1),{key:t,val:ch}):!1}:j==this.type?(i=e.length,this.match=function(n,r){r=!1!==r;var l=e,s=str=n.string.substr(n.pos,i);return l==s?(r&&(n.pos+=i),{key:t,val:str}):!1}):this.match=U==this.type?function(n,i){i=!1!==i;var r=n.string.slice(n.pos).match(e);return!r||r.index>0?!1:(i&&(n.pos+=r[0].length),{key:t,val:r})}:T_ENDOFLINEMATCHER==this.type?function(n,e){return!1!==e&&(n.pos=n.string.length),{key:t,val:""}}:C==this.type?function(){return{key:t,val:e}}:function(){return!1}},X=function(n,e){var t=n.length;e=!1!==e,this.type=P,this.match=0>=t?function(){return!1}:1==t?n[0].match:e?function(e,i){var r,l;for(r=0;t>r;r++)if(l=n[r].match(e,i))return{key:r,val:l.val};return!1}:function(e,i){var r,l;for(r=0;t>r;r++)if(l=n[r].match(e,i))return l;return!1}},Y=function(n,e){var t,i,r=new X(n,!1);this.type=H,this.match=function(n,s){return t=r.match(n,s),t?(i=e[t.key],l(i)&&(i=ne(t.val[i+1])),i):!1}},Z=function(n,e,t){var i,r,s,u=new X(n,!1),o="";this.type=H,this.match=function(n,a){return i=u.match(n,a),i?(r=e[i.key],l(r)?o=i.val[r+1]:(o=r.match(i.val),o=o?o.val:""),s=t[i.key],l(s)&&(s=ne(i.val[s+1])),[s,o]):!1}},ne=function(n,e){return e=e||0,l(n)?n:s(n)?new W(C,n,e):r(null,n)?new W(T_ENDOFLINEMATCHER,n,e):u(n)?new W(N,n,e):o(n)?new W(j,n,e):a(n)?new W(U,n,e):n},ee=function(n,e,t){var i,r,l,s,u=!1,o=!1;if(i=m(n),l=i.length,t)for(s=(l>>1)+1,r=0;s>=r;r++){if(f(i[r])||f(i[l-1-r])){u=!0;break}if(J(i[r],e)||J(i[l-1-r],e)){o=!0;break}}if(!t||u||o){for(r=0;l>r;r++)i[r]=f(i[r])?ee(i[r],e,t):ne(K(i[r],e),r);return i.length>1?new X(i):i[0]}return ne(Q(i))},te=function(n,e){var t,i,r,l,s,u,o;for(l=[],s=[],t=m(n),f(t[0])||(t=[t]),i=0,r=t.length;r>i;i++)u=ne(K(t[i][0],e),i),o=t[i].length>1?ne(K(t[i][1],e),i):u,l.push(u),s.push(o);return new Y(l,s)},ie=function(n,e,t){var i,r,l,s,u,o,a,c,b;for(s=[],u=[],o=[],i=m(n),f(i[0])||(i=[i]),r=0,l=i.length;l>r;r++)a=ne(K(i[r][0],e),r),c=i[r].length>2?ne(K(i[r][2],e),r):a,b=i[r].length>1?ee(K(i[r][1],e,t),r):a,s.push(a),u.push(b),o.push(c);return new Z(s,u,o)},re=function(n,e,t,i){var r=function(r,l){for(var s=!1;!r.eol();){if(n.match(r)){s=!0;break}r.next()}return s&&(l.tokenize=i||null),l.lastToken=e,t};return r.type=e|G,r},le=function(n,e,t,i,r){var l=function(l,s){for(var u=!1,o="",a=!1;!l.eol();){if(!u&&n.match(l)){a=!0;break}o=l.next(),u=!u&&"\\"==o}return(a||!u&&!i)&&(s.tokenize=r||null),s.lastToken=e,t};return l.type=e,l},se=function(n,e,t,i){var r=n[0],l=n[1],s=function(n,u){var o;return o=t[0]||null,o&&r===o[0]?(t.shift(),u.lastToken=S):(t.unshift([r,s,l]),u.lastToken=I),u.tokenize=i||null,e};return s.type=I,s},ue=function(n,e){var t=function(t,i){for(var r,l=!1,s=1;!l&&(r=t.next(),null!=r);)if("<"!=r)if(">"!=r);else{if(1==s){i.tokenize=e||null;break}s--}else s++;return i.lastToken=L,n};return t.type=L,t},oe=function(n,e){var t=e.DEFAULT,i=(n.Style||{},n.TokenOrder||[]),r=i.length,l=(n.hasIndent,n.indent,[]),s=function(n,s){var u,o,a,f,c,m,b=e.conf.multiLineStrings,g=null;if(n.eatSpace())return s.lastToken=p,t;if(g=l[0]||null,g&&g[0].match(n))return s.tokenize=g[1],s.tokenize(n,s);for(u=0;r>u;u++)if(o=i[u]){if(a=o[0],f=o[1],c=o[2],(y|G)&f&&(m=a.match(n)))return s.tokenize=re(m,f,c),s.tokenize(n,s);if(w&f&&(m=a.match(n)))return s.tokenize=le(m,f,c,b),s.tokenize(n,s);if(a.match(n))return s.lastToken=f,c}return n.next(),s.lastToken=p,t};return s.type=$,s},ae=function(n,e){var t=e.DEFAULT,i=(n.Style||{},n.TokenOrder||[]),r=i.length,l=(n.attributes||null,n.attributes2||null,n.attributes3||null,n.assignments||null,n.hasIndent,n.indent,[]);return function(n,s){var u,o,a,f,c,m,b=e.conf.multiLineStrings,g=null;if(n.eatSpace())return s.lastToken=p,t;if(g=l[0]||null,g&&g[0].match(n))return s.tokenize=g[1],s.tokenize(n,s);for(u=0;r>u;u++)if(o=i[u]){if(a=o[0],f=o[1],c=o[2],(y|G)&f&&(m=a.match(n)))return s.tokenize=re(m,f,c),s.tokenize(n,s);if(L&f&&a.match(n))return s.tokenize=ue(c),s.tokenize(n,s);if(I&f&&(m=a.match(n)))return s.tokenize=se(m,c,l),s.tokenize(n,s);if(w&f&&(m=a.match(n)))return s.tokenize=le(m,f,c,b),s.tokenize(n,s);if(l.length&&D&f&&a.match(n))return s.lastToken=f,c;if(!(D&f)&&a.match(n))return s.lastToken=f,c}return n.next(),s.lastToken=p,t}},fe=function(n,e,t){t.DEFAULT,e.hasIndent;var i=function(e,i){t.conf.multiLineStrings,t.basecolumn||0,t.conf.indentUnit;var r;return t.indentInfo=null,null==i.tokenize&&(i.tokenize=n),r=i.tokenize(e,i)};return i.type=V,i},ce=function(n){return n.DEFAULT,function(){return n.basecolumn||0,n.conf.indentUnit,CodeMirror.Pass}},me={VERSION:n,parseGrammar:function(n,e){return n.type&&"markup-like"==n.type?me.parseMarkupLikeGrammar(n,e||k):me.parseProgrammingLikeGrammar(n,e||d)},parseMarkupLikeGrammar:function(n,e){var i,r,l,s,u,o,a,f,c,b,d,k,p,S=[];if(n.__parsed)return n;for(n=g(n,e),u=n.RegExpID||null,n.RegExpID=null,delete n.RegExpID,o=n.RegExpGroups||{},n.RegExpGroups=null,delete n.RegExpGroups,n.type=M,a=n.TokenOrder||[],f=a.length,c=n.Style||{},t=0;f>t;t++)if(b=a[t],n[b]){if(d=null,"comments"==b){if(i=[],n.comments.line)for(r=m(n.comments.line),l=0,s=r.length;s>l;l++)i.push([r[l],null]);n.comments.block&&(r=m(n.comments.block),i.push([r[0],r[1]?r[1]:r[0]])),d=i.length?te(i,u):null,k=y,p=c.comment}else if("blocks"==b)d=te(n.blocks,u)||null,k=G,p=c.block;else if("blocks2"==b)d=te(n.blocks2,u)||null,k=G,p=c.block2;else if("blocks3"==b)d=te(n.blocks3,u)||null,k=G,p=c.block3;else if("blocks4"==b)d=te(n.blocks4,u)||null,k=G,p=c.block4;else if("blocks5"==b)d=te(n.blocks5,u)||null,k=G,p=c.block5;else if("tags"==b)d=ie(n.tags,u,o.tags)||null,k=I,p=c.tag;else if("tags2"==b)d=ie(n.tags2,u,o.tags2)||null,k=I,p=c.tag2;else if("tags3"==b)d=ie(n.tags3,u,o.tags3)||null,k=I,p=c.tag3;else if("attributes"==b)d=ee(n.attributes,u,o.attributes)||null,k=D,p=c.attribute;else if("attributes2"==b)d=ee(n.attributes2,u,o.attributes2)||null,k=D,p=c.attribute2;else if("attributes3"==b)d=ee(n.attributes3,u,o.attributes3)||null,k=D,p=c.attribute3;else if("assignments"==b)d=ee(n.assignments,u,o.assignments)||null,k=O,p=c.assignment;else{if("doctype"==b)continue;if("strings"==b)d=te(n.strings,u)||null,k=w,p=c.string;else if("strings2"==b)d=te(n.strings2,u)||null,k=w,p=c.string2;else if("strings3"==b)d=te(n.strings3,u)||null,k=w,p=c.string3;else if("strings4"==b)d=te(n.strings4,u)||null,k=w,p=c.string4;else if("strings5"==b)d=te(n.strings5,u)||null,k=w,p=c.string5;else if("numbers"==b)d=ee(n.numbers,u,o.numbers)||null,k=R,p=c.number;else if("numbers2"==b)d=ee(n.numbers2,u,o.numbers2)||null,k=R,p=c.number2;else if("numbers3"==b)d=ee(n.numbers3,u,o.numbers3)||null,k=R,p=c.number3;else if("identifiers"==b)d=ee(n.identifiers,u,o.identifiers)||null,k=z,p=c.identifier;else if("identifiers2"==b)d=ee(n.identifiers2,u,o.identifiers2)||null,k=z,p=c.identifier2;else if("identifiers3"==b)d=ee(n.identifiers3,u,o.identifiers3)||null,k=z,p=c.identifier3;else if("identifiers4"==b)d=ee(n.identifiers4,u,o.identifiers4)||null,k=z,p=c.identifier4;else if("identifiers5"==b)d=ee(n.identifiers5,u,o.identifiers5)||null,k=z,p=c.identifier5;else if("atoms"==b)d=ee(n.atoms,u,o.atoms)||null,k=E,p=c.atom;else if("meta"==b)d=ee(n.meta,u,o.meta)||null,k=h,p=c.meta;else if("defines"==b)d=ee(n.defines,u,o.defines)||null,k=v,p=c.defines;else if("keywords"==b)d=ee(n.keywords,u,o.keywords)||null,k=T,p=c.keyword;else if("builtins"==b)d=ee(n.builtins,u,o.builtins)||null,k=x,p=c.builtin;else{if("operators"==b)continue;if("delimiters"==b)continue}}d?(n[b]=d,S.push([d,k,p])):n[b]=null}return n.TokenOrder=S,n.indent=null,n.hasIndent=!1,n.__parsed=!0,n},parseProgrammingLikeGrammar:function(n,e){var i,r,l,s,u,o,a,f,c,b,d,k,p,I=[];if(n.__parsed)return n;for(n=g(n,e),u=n.RegExpID||null,n.RegExpID=null,delete n.RegExpID,o=n.RegExpGroups||{},n.RegExpGroups=null,delete n.RegExpGroups,n.type=F,a=n.TokenOrder||[],f=a.length,c=n.Style||{},t=0;f>t;t++)if(b=a[t],n[b]){if(d=null,"comments"==b){if(i=[],n.comments.line)for(r=m(n.comments.line),l=0,s=r.length;s>l;l++)i.push([r[l],null]);n.comments.block&&(r=m(n.comments.block),i.push([r[0],r[1]?r[1]:r[0]])),d=i.length?te(i,u):null,k=y,p=c.comment}else"blocks"==b?(d=te(n.blocks,u)||null,k=G,p=c.block):"blocks2"==b?(d=te(n.blocks2,u)||null,k=G,p=c.block2):"blocks3"==b?(d=te(n.blocks3,u)||null,k=G,p=c.block3):"blocks4"==b?(d=te(n.blocks4,u)||null,k=G,p=c.block4):"blocks5"==b?(d=te(n.blocks5,u)||null,k=G,p=c.block5):"strings"==b?(d=te(n.strings,u)||null,k=w,p=c.string):"strings2"==b?(d=te(n.strings2,u)||null,k=w,p=c.string2):"strings3"==b?(d=te(n.strings3,u)||null,k=w,p=c.string3):"strings4"==b?(d=te(n.strings4,u)||null,k=w,p=c.string4):"strings5"==b?(d=te(n.strings5,u)||null,k=w,p=c.string5):"numbers"==b?(d=ee(n.numbers,u,o.numbers)||null,k=R,p=c.number):"numbers2"==b?(d=ee(n.numbers2,u,o.numbers2)||null,k=R,p=c.number2):"numbers3"==b?(d=ee(n.numbers3,u,o.numbers3)||null,k=R,p=c.number3):"identifiers"==b?(d=ee(n.identifiers,u,o.identifiers)||null,k=z,p=c.identifier):"identifiers2"==b?(d=ee(n.identifiers2,u,o.identifiers2)||null,k=z,p=c.identifier2):"identifiers3"==b?(d=ee(n.identifiers3,u,o.identifiers3)||null,k=z,p=c.identifier3):"identifiers4"==b?(d=ee(n.identifiers4,u,o.identifiers4)||null,k=z,p=c.identifier4):"identifiers5"==b?(d=ee(n.identifiers5,u,o.identifiers5)||null,k=z,p=c.identifier5):"atoms"==b?(d=ee(n.atoms,u,o.atoms)||null,k=E,p=c.atom):"meta"==b?(d=ee(n.meta,u,o.meta)||null,k=h,p=c.meta):"defines"==b?(d=ee(n.defines,u,o.defines)||null,k=v,p=c.defines):"keywords"==b?(d=ee(n.keywords,u,o.keywords)||null,k=T,p=c.keyword):"builtins"==b?(d=ee(n.builtins,u,o.builtins)||null,k=x,p=c.builtin):"operators"==b?(d=ee(n.operators,u,o.operators)||null,k=A,p=c.operator):"delimiters"==b&&(d=ee(n.delimiters,u,o.delimiters)||null,k=_,p=c.delimiter);d?(n[b]=d,I.push([d,k,p])):n[b]=null}return n.TokenOrder=I,n.indent=null,n.hasIndent=!1,n.__parsed=!0,n},getMode:function(n,e,t){n=me.parseGrammar(n,e);var i,r,l,s={DEFAULT:t||null};return i=M==n.type?ae(n,s):oe(n,s),r=fe(i,n,s),l=ce(s),function(n,e){return s.conf=n,s.parserConf=e,{startState:function(n){return s.basecolumn=n||0,{tokenize:null,lastToken:p}},token:r,indent:l}}}};"undefined"!=typeof module&&module.exports?module.exports=me:"undefined"!=typeof exports?exports=me:this.CodeMirrorGrammar=me}).call(this);