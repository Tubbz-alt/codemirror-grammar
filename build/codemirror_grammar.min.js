/**
*
*   CodeMirrorGrammar
*   Transform a grammar specification in JSON format,
*   into a CodeMirror syntax-highlight parser mode
*
*   https://github.com/foo123/codemirror-grammar
*
**/(function(){var e="0.1",n=(Array.prototype.slice,Object.prototype.hasOwnProperty),t=Object.prototype.toString,l=function(e){return"number"==typeof e||e instanceof Number},r=function(e){return e&&("string"==typeof e||e instanceof String)&&1==e.length},i=function(e){return e&&("string"==typeof e||e instanceof String)},s=function(e){return e&&("[object RegExp]"==t.call(e)||e instanceof RegExp)},u=function(e){return e&&"[object Array]"==t.call(e)},o=function(e){return e&&"[object Object]"==t.call(e)},a=function(e){return u(e)?e:[e]},k=function(e){if(!o(e)&&!u(e))return e;var t={};for(var l in e)n.call(e,l)&&(t[l]=o(e[l])?k(e[l]):u(e[l])?e[l].slice():e[l]);return t},d=function(e,t){if(!o(t)&&!u(t))return k(e);var l={};for(var r in t)n.call(t,r)&&(l[r]=n.call(e,r)?o(e[r])&&!i(e[r])?d(e[r],t[r]):u(e[r])?e[r].slice():e[r]:k(t[r]));return l},b={RegExpID:null,RegExpGroups:null,style:{error:"error",comment:"comment",meta:"meta",defines:"def",atom:"atom",keyword:"keyword",builtin:"builtin",operator:"operator",identifier:"variable",identifier2:"variable",identifier3:"variable",identifier4:"variable",identifier5:"variable",number:"number",number2:"number",number3:"number",string:"string",string2:"string",string3:"string",block:"string",block2:"string",block3:"string",block4:"string",block5:"string",delimiter:"meta"},comments:{line:null,block:null},blocks:null,blocks2:null,blocks3:null,blocks4:null,blocks5:null,identifiers:null,identifiers2:null,identifiers3:null,identifiers4:null,identifiers5:null,numbers:null,numbers2:null,numbers3:null,strings:null,strings2:null,strings3:null,operators:{one:null,two:null,words:null},delimiters:{one:null,two:null,three:null},atoms:null,meta:null,defines:null,keywords:null,builtins:null,indent:null},m={RegExpID:null,RegExpGroups:null,style:{error:"error",comment:"comment",meta:"meta",defines:"def",atom:"atom",keyword:"keyword",builtin:"builtin",operator:"operator",assignment:null,tag:"tag",tag2:"tag",tag3:"tag",attribute:"attribute",attribute2:"attribute",attribute3:"attribute",identifier:"variable",identifier2:"variable",identifier3:"variable",identifier4:"variable",identifier5:"variable",number:"number",number2:"number",number3:"number",string:"string",string2:"string",string3:"string",block:"string",block2:"string",block3:"string",block4:"string",block5:"string",delimiter:"meta"},comments:{line:null,block:null},blocks:null,blocks2:null,blocks3:null,blocks4:null,blocks5:null,tags:null,tags2:null,tags3:null,autoclose:null,attributes:null,attributes2:null,attributes3:null,identifiers:null,identifiers2:null,identifiers3:null,identifiers4:null,identifiers5:null,numbers:null,numbers2:null,numbers3:null,strings:null,strings2:null,strings3:null,atoms:null,meta:null,defines:null,keywords:null,builtins:null,assignments:null,operators:{one:null,two:null,words:null},delimiters:{one:null,two:null,three:null},indent:null},c=1,f=2,g=4,p=8,y=16,v=32,z=64,w=128,T=256,h=512,E=1024,x=2048,_=4096,R=8192,G=16384,I=32768,D=65536,L=131072,S=262144,A=200,M=220,U=300,j=310,F=320,O=/([\-\.\*\+\?\^\$\{\}\(\)\|\[\]\/\\])/g,P=function(e,n){if(!e||l(e))return e;var t=n?n.length:0;return t&&n==e.substr(0,t)?new RegExp("^"+e.substr(t)):e},C=function(e){for(var n=0,t=e.length;t>n;n++)e[n]=e[n].replace(O,"\\$1");return new RegExp("^(("+e.join(")|(")+"))\\b")},N=function(e,n){var t,u;return n=n||0,l(e)?e:r(e)?(t=function(t,l){l=!1!==l;var r=e,i=t.string.charAt(t.pos)||"";return r==i?(l&&(t.pos+=1),{key:n,val:i}):!1},t.__type=U,t):i(e)?(u=e.length,t=function(t,l){l=!1!==l;var r=e,i=t.string.substr(t.pos,u),s=i;return r==s?(l&&(t.pos+=u),{key:n,val:i}):!1},t.__type=j,t):s(e)?(t=function(t,l){l=!1!==l;var r=t.string.slice(t.pos).match(e);return!r||r.index>0?!1:(l&&(t.pos+=r[0].length),{key:n,val:r})},t.__type=F,t):e},$=function(e,n,t){if(t)return[N(C(a(e)))];var l,r,i;for(l=a(e),r=0,i=l.length;i>r;r++)l[r]=N(P(l[r],n),r);return l},V=function(e,n){var t,l,r,i,s,o,k;for(i=[],s=[],t=a(e),u(t[0])||(t=[t]),l=0,r=t.length;r>l;l++)o=N(P(t[l][0],n),l),k=t[l].length>1?N(P(t[l][1],n),l):o,i.push(o),s.push(k);return{start:i,end:s}},q=function(e,n,t){var l,r,i=n.length;for(l=0;i>l;l++)if(r=n[l](e,t))return r;return!1},B=function(e,n,t,l){var r;return r=null==e?function(e,r){return e.skipToEnd(),r.tokenize=l||null,r.lastToken=n,t}:function(r,i){for(var s=!1;!r.eol();){if(e(r)){s=!0;break}r.next()}return s&&(i.tokenize=l||null),i.lastToken=n,t},r.__type=n,r},H=function(e,n,t,l){var r=function(r,i){for(var s,u=!1,o=!1;!r.eol();){if(e(r)&&!u){o=!0;break}s=r.next(),u=!u&&"\\"==s}return(o||!u&&!t)&&(i.tokenize=l||null),i.lastToken=w,n};return r.__type=w,r},J=function(e,n,t){var l=n.DEFAULT,r=n.style,i=n.tags,s=n.attributes,u=n.assignments,o=n.strings,a=n.stringsEnd,k=!1,d=function(n,b){var m;return b.lastToken,!k&&i&&(m=q(n,i))?(b.lastToken=E,k=!0,r.tag):k?n.eatSpace()?(b.lastToken=c,l):e(n)?(b.tokenize=t||null,b.lastToken=R,r.tag):s&&q(n,s)?(b.lastToken=x,r.attribute):u&&q(n,u)?(b.lastToken=_,l):o&&(m=q(n,o))?(b.tokenize=H(N(a[m.key]),r.string,!1,d),b.tokenize(n,b)):(b.lastToken=c,l):(b.lastToken=G,r.error)};return d.__type=E,d},K=function(e,n){var t=function(t,l){for(var r,i=!1,s=1;!i&&(r=t.next(),null!=r);)if("<"!=r)if(">"!=r);else{if(1==s){l.tokenize=n||null;break}s--}else s++;return l.lastToken=D,e};return t.__type=D,t},Q=function(e,n,t){var r=n.DEFAULT,i=t.multiLineStrings,s=e.style,u=e.comments.start||null,o=e.comments.end||null,a=e.blocks.start||null,k=e.blocks.end||null,d=e.blocks2.start||null,b=e.blocks2.end||null,m=e.blocks3.start||null,w=e.blocks3.end||null,E=e.blocks4.start||null,x=e.blocks4.end||null,_=e.blocks5.start||null,R=e.blocks5.end||null,G=e.strings.start||null,D=e.strings.end||null,M=e.strings2.start||null,U=e.strings2.end||null,j=e.strings3.start||null,F=e.strings3.end||null,O=e.identifiers,P=e.identifiers2,C=e.identifiers3,$=e.identifiers4,V=e.identifiers5,J=e.numbers,K=e.numbers2,Q=e.numbers3,W=e.atoms,X=e.meta,Y=e.defines,Z=e.keywords,en=e.builtins,nn=e.operators,tn=e.delimiters;e.hasIndent,e.indent;var ln=function(e,n){var t,A,ln;return e.eatSpace()?(n.lastToken=c,r):u&&(A=q(e,u))?(ln=o[A.key],l(ln)&&(ln=A.val[ln]),n.tokenize=B(N(ln),g,s.comment),n.tokenize(e,n)):a&&(A=q(e,a))?(ln=k[A.key],l(ln)&&(ln=A.val[ln]),n.tokenize=B(N(ln),I,s.block),n.tokenize(e,n)):d&&(A=q(e,d))?(ln=b[A.key],l(ln)&&(ln=A.val[ln]),n.tokenize=B(N(ln),I,s.block2),n.tokenize(e,n)):m&&(A=q(e,m))?(ln=w[A.key],l(ln)&&(ln=A.val[ln]),n.tokenize=B(N(ln),I,s.block3),n.tokenize(e,n)):E&&(A=q(e,E))?(ln=x[A.key],l(ln)&&(ln=A.val[ln]),n.tokenize=B(N(ln),I,s.block4),n.tokenize(e,n)):_&&(A=q(e,_))?(ln=R[A.key],l(ln)&&(ln=A.val[ln]),n.tokenize=B(N(ln),I,s.block5),n.tokenize(e,n)):J&&q(e,J)?(n.lastToken=h,s.number):K&&q(e,K)?(n.lastToken=h,s.number2):Q&&q(e,Q)?(n.lastToken=h,s.number3):G&&(A=q(e,G))?(ln=D[A.key],l(ln)&&(ln=A.val[ln]),n.tokenize=H(N(ln),s.string,i),n.tokenize(e,n)):M&&(A=q(e,M))?(ln=U[A.key],l(ln)&&(ln=A.val[ln]),n.tokenize=H(N(ln),s.string2,i),n.tokenize(e,n)):j&&(A=q(e,j))?(ln=F[A.key],l(ln)&&(ln=A.val[ln]),n.tokenize=H(N(ln),s.string3,i),n.tokenize(e,n)):tn&&(tn.three&&q(e,tn.three)||tn.two&&q(e,tn.two))?(n.lastToken=S,s.delimiter):nn&&(nn.two&&q(e,nn.two)||nn.one&&q(e,nn.one)||nn.words&&q(e,nn.words))?(n.lastToken=L,s.operator):tn&&tn.one&&q(e,tn.one)?(n.lastToken=S,s.delimiter):W&&q(e,W)?(n.lastToken=y,s.atom):X&&q(e,X)?(n.lastToken=f,s.meta):Y&&q(e,Y)?(n.lastToken=p,s.defines):Z&&q(e,Z)?(t=e.current(),n.lastToken=v,s.keyword):en&&q(e,en)?(t=e.current(),n.lastToken=z,s.builtin):O&&q(e,O)?(n.lastToken=T,s.identifier):P&&q(e,P)?(n.lastToken=T,s.identifier2):C&&q(e,C)?(n.lastToken=T,s.identifier3):$&&q(e,$)?(n.lastToken=T,s.identifier4):V&&q(e,V)?(n.lastToken=T,s.identifier5):(e.next(),n.lastToken=c,r)};return ln.__type=A,ln},W=function(e,n){var t=n.DEFAULT,r=e.style,i=e.comments.start||null,s=e.comments.end||null,u=e.blocks.start||null,o=e.blocks.end||null,a=e.blocks2.start||null,k=e.blocks2.end||null,d=e.blocks3.start||null,b=e.blocks3.end||null,m=e.blocks4.start||null,w=e.blocks4.end||null,h=e.blocks5.start||null,E=e.blocks5.end||null,x=e.strings.start||null,_=e.strings.end||null,R=e.strings2.start||null,G=e.strings2.end||null,D=e.strings3.start||null,L=e.strings3.end||null,S=e.doctype,A=e.tags.start||null,M=e.tags.tags||null,U=e.tags.end||null,j=e.attributes,F=(e.attributes2,e.attributes3,e.assignments),O=e.identifiers,P=e.identifiers2,C=e.identifiers3,$=e.identifiers4,V=e.identifiers5,Q=(e.numbers,e.numbers2,e.numbers3,e.atoms),W=e.meta,X=e.defines,Y=e.keywords,Z=e.builtins;return e.operators,e.delimiters,e.hasIndent,e.indent,function(e,en){var nn,tn,ln;if(e.eatSpace())return en.lastToken=c,t;if(i&&(tn=q(e,i)))return ln=s[tn.key],l(ln)&&(ln=tn.val[ln]),en.tokenize=B(N(ln),g,r.comment),en.tokenize(e,en);if(u&&(tn=q(e,u)))return ln=o[tn.key],l(ln)&&(ln=tn.val[ln]),en.tokenize=B(N(ln),I,r.block),en.tokenize(e,en);if(a&&(tn=q(e,a)))return ln=k[tn.key],l(ln)&&(ln=tn.val[ln]),en.tokenize=B(N(ln),I,r.block2),en.tokenize(e,en);if(d&&(tn=q(e,d)))return ln=b[tn.key],l(ln)&&(ln=tn.val[ln]),en.tokenize=B(N(ln),I,r.block3),en.tokenize(e,en);if(m&&(tn=q(e,m)))return ln=w[tn.key],l(ln)&&(ln=tn.val[ln]),en.tokenize=B(N(ln),I,r.block4),en.tokenize(e,en);if(h&&(tn=q(e,h)))return ln=E[tn.key],l(ln)&&(ln=tn.val[ln]),en.tokenize=B(N(ln),I,r.block5),en.tokenize(e,en);if(S&&q(e,S))return en.tokenize=K(r.doctype),en.tokenize(e,en);if(Q&&q(e,Q))return en.lastToken=y,r.atom;if(x&&(tn=q(e,x)))return ln=_[tn.key],l(ln)&&(ln=tn.val[ln]),en.tokenize=H(N(ln),r.string,!1),en.tokenize(e,en);if(R&&(tn=q(e,R)))return ln=G[tn.key],l(ln)&&(ln=tn.val[ln]),en.tokenize=H(N(ln),r.string2,!1),en.tokenize(e,en);if(D&&(tn=q(e,D)))return ln=L[tn.key],l(ln)&&(ln=tn.val[ln]),en.tokenize=H(N(ln),r.string3,!1),en.tokenize(e,en);if(W&&(tn=q(e,W))){var rn=tn.key,sn=tn.val,un=metaEnd[rn];return l(un)&&(un=sn[un]),en.tokenize=B(N(un),f,r.meta),en.tokenize(e,en)}return A&&(tn=q(e,A))?(ln=U[tn.key],l(ln)&&(ln=tn.val[ln]),n.style=r,n.tags=M,n.attributes=j,n.assignments=F,n.strings=x,n.stringsEnd=_,en.tokenize=J(N(ln),n),en.tokenize(e,en)):X&&q(e,X)?(en.lastToken=p,r.defines):Y&&q(e,Y)?(nn=e.current(),en.lastToken=v,r.keyword):Z&&q(e,Z)?(nn=e.current(),en.lastToken=z,r.builtin):O&&q(e,O)?(en.lastToken=T,r.identifier):P&&q(e,P)?(en.lastToken=T,r.identifier2):C&&q(e,C)?(en.lastToken=T,r.identifier3):$&&q(e,$)?(en.lastToken=T,r.identifier4):V&&q(e,V)?(en.lastToken=T,r.identifier5):(e.next(),en.lastToken=c,t)}},X=function(e,n,t,l){t.DEFAULT,t.basecolumn||0,l.indentUnit,n.hasIndent;var r=function(n,l){var r,i,s;return t.indentInfo=null,null==l.tokenize&&(l.tokenize=e),r=l.tokenize(n,l),i=l.lastToken,s=n.current(),r};return r.__type=M,r},Y=function(e,n){return e.DEFAULT,e.basecolumn||0,n.indentUnit,function(){return CodeMirror.Pass}},Z={VERSION:e,parseGrammar:function(e,n){return e.type&&"markup-like"==e.type?Z.parseMarkupLikeGrammar(e,n||m):Z.parseProgrammingLikeGrammar(e,n||b)},parseMarkupLikeGrammar:function(e,n){var t,l,r,i,s,u;if(e.__parsed)return e;if(e=d(e,n),s=e.RegExpID||null,e.RegExpID=null,delete e.RegExpID,u=e.RegExpGroups||{},e.RegExpGroups=null,delete e.RegExpGroups,e.type=null,delete e.type,e.isMarkup=!0,e.comments){if(t=[],e.comments.line)for(l=a(e.comments.line),r=0,i=l.length;i>r;r++)t.push([l[r],null]);e.comments.block&&(l=a(e.comments.block),t.push([l[0],l[1]?l[1]:l[0]])),e.comments=t.length?V(t,s):{start:null,end:null}}else e.comments={start:null,end:null};if(e.blocks=e.blocks?V(e.blocks,s):{start:null,end:null},e.blocks2=e.blocks2?V(e.blocks2,s):{start:null,end:null},e.blocks3=e.blocks3?V(e.blocks3,s):{start:null,end:null},e.blocks4=e.blocks4?V(e.blocks4,s):{start:null,end:null},e.blocks5=e.blocks5?V(e.blocks5,s):{start:null,end:null},e.tags){t=[],l=[];var o=a(e.tags);for(r=0,i=o.length;i>r;r++)t.push([o[r][0],o[r][1]]),l=l.concat(o[r][2]);t=V(t,s),l=$(l,s,u.tags),e.tags={start:t.start,tags:l,end:t.end}}else e.tags={start:null,tags:null,end:null};return e.tags2={start:null,tags:null,end:null},e.tags3={start:null,tags:null,end:null},e.attributes=e.attributes?$(e.attributes,s,u.attributes):null,e.attributes2=e.attributes2?$(e.attributes2,s,u.attributes2):null,e.attributes3=e.attributes3?$(e.attributes3,s,u.attributes3):null,e.doctype=null,e.strings=e.strings?V(e.strings,s):{start:null,end:null},e.strings2=e.strings2?V(e.strings2,s):{start:null,end:null},e.strings3=e.strings3?V(e.strings3,s):{start:null,end:null},e.identifiers=e.identifiers?$(e.identifiers,s,u.identifiers):null,e.identifiers2=e.identifiers2?$(e.identifiers2,s,u.identifiers2):null,e.identifiers3=e.identifiers3?$(e.identifiers3,s,u.identifiers3):null,e.identifiers4=e.identifiers4?$(e.identifiers4,s,u.identifiers4):null,e.identifiers5=e.identifiers5?$(e.identifiers5,s,u.identifiers5):null,e.numbers=e.numbers?$(e.numbers,s,u.numbers):null,e.numbers2=e.numbers2?$(e.numbers2,s,u.numbers2):null,e.numbers3=e.numbers3?$(e.numbers3,s,u.numbers3):null,e.atoms=e.atoms?$(e.atoms,s,u.atoms):null,e.meta=e.meta?$(e.meta,s,u.meta):null,e.defines=e.defines?$(e.defines,s,u.defines):null,e.keywords=e.keywords?$(e.keywords,s,u.keywords):null,e.builtins=e.builtins?$(e.builtins,s,u.builtins):null,e.assignments=e.assignments?$(e.assignments,s,u.assignments):null,e.operators={one:null,two:null,words:null},e.delimiters={one:null,two:null,three:null},e.indent=null,e.hasIndent=!1,e.__parsed=!0,e},parseProgrammingLikeGrammar:function(e,n){var t,l,r,i,s,u;if(e.__parsed)return e;if(e=d(e,n),s=e.RegExpID||null,e.RegExpID=null,delete e.RegExpID,u=e.RegExpGroups||{},e.RegExpGroups=null,delete e.RegExpGroups,e.type=null,delete e.type,e.isMarkup=!1,e.comments){if(t=[],e.comments.line)for(l=a(e.comments.line),r=0,i=l.length;i>r;r++)t.push([l[r],null]);e.comments.block&&(l=a(e.comments.block),t.push([l[0],l[1]?l[1]:l[0]])),e.comments=t.length?V(t,s):{start:null,end:null}}else e.comments={start:null,end:null};return e.blocks=e.blocks?V(e.blocks,s):{start:null,end:null},e.blocks2=e.blocks2?V(e.blocks2,s):{start:null,end:null},e.blocks3=e.blocks3?V(e.blocks3,s):{start:null,end:null},e.blocks4=e.blocks4?V(e.blocks4,s):{start:null,end:null},e.blocks5=e.blocks5?V(e.blocks5,s):{start:null,end:null},e.strings=e.strings?V(e.strings,s):{start:null,end:null},e.strings2=e.strings2?V(e.strings2,s):{start:null,end:null},e.strings3=e.strings3?V(e.strings3,s):{start:null,end:null},e.identifiers=e.identifiers?$(e.identifiers,s,u.identifiers):null,e.identifiers2=e.identifiers2?$(e.identifiers2,s,u.identifiers2):null,e.identifiers3=e.identifiers3?$(e.identifiers3,s,u.identifiers3):null,e.identifiers4=e.identifiers4?$(e.identifiers4,s,u.identifiers4):null,e.identifiers5=e.identifiers5?$(e.identifiers5,s,u.identifiers5):null,e.numbers=e.numbers?$(e.numbers,s,u.numbers):null,e.numbers2=e.numbers2?$(e.numbers2,s,u.numbers2):null,e.numbers3=e.numbers3?$(e.numbers3,s,u.numbers3):null,e.atoms=e.atoms?$(e.atoms,s,u.atoms):null,e.meta=e.meta?$(e.meta,s,u.meta):null,e.defines=e.defines?$(e.defines,s,u.defines):null,e.keywords=e.keywords?$(e.keywords,s,u.keywords):null,e.builtins=e.builtins?$(e.builtins,s,u.builtins):null,e.operators||(e.operators={one:null,two:null,words:null}),e.operators.one=e.operators.one?$(e.operators.one,s,u.operators&&u.operators.one):null,e.operators.two=e.operators.two?$(e.operators.two,s,u.operators&&u.operators.two):null,e.operators.words=e.operators.words?$(e.operators.words,s,u.operators&&u.operators.words):null,e.delimiters||(e.delimiters={one:null,two:null,three:null}),e.delimiters.one=e.delimiters.one?$(e.delimiters.one,s,u.delimiters&&u.delimiters.one):null,e.delimiters.two=e.delimiters.two?$(e.delimiters.two,s,u.delimiters&&u.delimiters.two):null,e.delimiters.three=e.delimiters.three?$(e.delimiters.three,s,u.delimiters&&u.delimiters.three):null,e.indent=null,e.hasIndent=!1,e.__parsed=!0,e},getMode:function(e,n,t){e=Z.parseGrammar(e,n);var l={DEFAULT:t||null};return e.isMarkup?function(n,t){var r=W(e,l,n,t),i=X(r,e,l,n,t),s=Y(l,n,t);return parser={startState:function(e){return l.basecolumn=e||0,{tokenize:null,lastToken:c}},token:i,indent:s}}:function(n,t){var r=Q(e,l,n,t),i=X(r,e,l,n,t),s=Y(l,n,t);return parser={startState:function(e){return l.basecolumn=e||0,{tokenize:null,lastToken:c}},token:i,indent:s}}}};"undefined"!=typeof module&&module.exports?module.exports=Z:"undefined"!=typeof exports?exports=Z:this.CodeMirrorGrammar=Z}).call(this);