/**
*
*   CodeMirrorGrammar
*   @version: 0.5.2
*   Transform a grammar specification in JSON format,
*   into a CodeMirror syntax-highlight parser mode
*
*   https://github.com/foo123/codemirror-grammar
*
**/!function(t,e,s,n){s=s?[].concat(s):[];var i,r=s.length,o=new Array(r),h=new Array(r),l=new Array(r);for(i=0;r>i;i++)o[i]=s[i][0],h[i]=s[i][1];if("object"==typeof module&&module.exports){if("undefined"==typeof module.exports[e]){for(i=0;r>i;i++)l[i]=module.exports[o[i]]||require(h[i])[o[i]];module.exports[e]=n.apply(t,l)}}else if("function"==typeof define&&define.amd)define(["exports"].concat(h),function(s){if("undefined"==typeof s[e]){for(var i=Array.prototype.slice.call(arguments,1),r=0,h=i.length;h>r;r++)l[r]=s[o[r]];s[e]=n.apply(t,l)}});else if("undefined"==typeof t[e]){for(i=0;r>i;i++)l[i]=t[o[i]];t[e]=n.apply(t,l)}}(this,"CodeMirrorGrammar",[["Classy","./classy"],["RegExAnalyzer","./regexanalyzer"]],function(t,e,s){var n,r="0.5.2",o=t.Class,h=2,u=4,c=8,a=9,f=16,p=32,g=64,k=128,m=256,R=512,d=33,y=34,v=36,E=40,O=64,C=128,b=4,P=8,x=16,w=32,B=64,A=65,S=128,q=256,L=512,T=1024,_=2048,M=4096,G=8192,j={ONEOF:S,EITHER:S,ALL:q,ALLOF:q,ZEROORONE:L,ZEROORMORE:T,ONEORMORE:_},D={BLOCK:B,COMMENT:A,"ESCAPED-BLOCK":w,SIMPLE:x,GROUP:M,NGRAM:G,"N-GRAM":G},$=Array.prototype.slice,N=(Array.prototype.splice,Array.prototype.concat,Object.prototype.hasOwnProperty),F=Object.prototype.toString,I=function(t){var e=typeof t,n=F.call(t);return"number"==e||t instanceof Number?h:!0===t||!1===t?u:t&&("string"==e||t instanceof String)?1==t.length?a:c:t&&("[object RegExp]"==n||t instanceof RegExp)?f:t&&("[object Array]"==n||t instanceof Array)?p:t&&"[object Object]"==n?g:null===t?k:s===t?m:R},K=function(t,e){return e||p!=I(t)?[t]:t},U=function(t,e){return t=K(t,e),(e||p!=I(t[0]))&&(t=[t]),t},z=function(t){var e,s=I(t);if(g!=s&&p!=s)return t;var n,i={};for(n in t)N.call(t,n)&&(e=I(t[n]),i[n]=g==e?z(t[n]):p==e?t[n].slice():t[n]);return i},Z=function(){var t=$.call(arguments),e=t.length;if(1>e)return null;if(2>e)return z(t[0]);var s,n,i,r,o=t.shift(),h=z(o);for(e--,n=0;e>n;n++)if(s=t.shift())for(i in s)N.call(s,i)&&(N.call(o,i)?(r=I(o[i]),g&~c&r&&(h[i]=Z(o[i],s[i]))):h[i]=z(s[i]));return h},H=/([\-\.\*\+\?\^\$\{\}\(\)\|\[\]\/\\])/g,V=function(t,e){return e.length-t.length},J=function(t,e){return c&I(e)&&c&I(t)&&e.length&&e.length<=t.length&&e==t.substr(0,e.length)},Q=function(t,s,n){if(!t||h==I(t))return t;var i=s?s.length||0:0;if(i&&s==t.substr(0,i)){var r,o,l,u="^("+t.substr(i)+")";return n[u]||(r=new RegExp(u),l=new e(r).analyze(),o=l.getPeekChars(),Object.keys(o.peek).length||(o.peek=null),Object.keys(o.negativepeek).length||(o.negativepeek=null),n[u]=[r,o]),n[u]}return t},W=function(t,e){var s,n,i={},r="";for(c==I(e)&&(r=e),s=0,n=t.length;n>s;s++)i[t[s].charAt(0)]=1,t[s]=t[s].replace(H,"\\$1");return[new RegExp("^("+t.sort(V).join("|")+")"+r),{peek:i,negativepeek:null},1]},X=o({constructor:function(t){this.string=t?""+t:"",this.start=this.pos=0,this.stream=null},stream:null,string:"",start:0,pos:0,fromStream:function(t){return this.stream=t,this.string=""+t.string,this.start=t.start,this.pos=t.pos,this},toString:function(){return this.string},sol:function(){return 0==this.pos},eol:function(){return this.pos>=this.string.length},chr:function(t,e){e=!1!==e;var s=this.string.charAt(this.pos)||"";return t==s?(e&&(this.pos+=1,this.stream&&(this.stream.pos=this.pos)),s):!1},str:function(t,e,s){s=!1!==s;var n=this.pos,i=this.string.charAt(n);if(e.peek[i]){var r=t.length,o=this.string.substr(n,r);if(t==o)return s&&(this.pos+=r,this.stream&&(this.stream.pos=this.pos)),o}return!1},rex:function(t,e,s,n){s=!1!==s,n=n||0;var i=this.pos,r=this.string.charAt(i);if(e.peek&&e.peek[r]||e.negativepeek&&!e.negativepeek[r]){var o=this.string.slice(i).match(t);return!o||o.index>0?!1:(s&&(this.pos+=o[n].length,this.stream&&(this.stream.pos=this.pos)),o)}return!1},mch:function(t,e,s,n){if("string"!=typeof t){n=n||0;var i=this.string.slice(this.pos).match(t);return i&&i.index>0?null:(i&&e!==!1&&(this.pos+=i[n].length),i)}var r=function(t){return s?t.toLowerCase():t},o=this.string.substr(this.pos,t.length);return r(o)==r(t)?(e!==!1&&(this.pos+=t.length),!0):void 0},end:function(){return this.pos=this.string.length,this.stream&&(this.stream.pos=this.pos),this},pk:function(){return this.string.charAt(this.pos)},nxt:function(){if(this.pos<this.string.length){var t=this.string.charAt(this.pos++);return this.stream&&(this.stream.pos=this.pos),t}},bck:function(t){return this.pos-=t,this.stream&&(this.stream.pos=this.pos),this},bck2:function(t){return this.pos=t,this.stream&&(this.stream.pos=this.pos),this},spc:function(){for(var t=this.pos,e=this.pos;/[\s\u00a0]/.test(this.string.charAt(e));)++e;return this.pos=e,this.stream&&(this.stream.pos=this.pos),this.pos>t},cur:function(){return this.string.slice(this.start,this.pos)},sft:function(){return this.start=this.pos,this}}),Y=o({constructor:function(t){this.id=t||0,this.stack=[],this.t=P,this.inBlock=null,this.endBlock=null},id:0,stack:null,t:null,inBlock:null,endBlock:null,clone:function(){var t=new this.$class;return t.id=this.id,t.stack=this.stack.slice(),t.inBlock=this.inBlock,t.endBlock=this.endBlock,t.t=this.t,t},toString:function(){return"_"+this.id+"_"+this.t+"_"+this.inBlock}}),te=o({constructor:function(t,e,s){this.type=d,this.name=t,this.t=e,this.k=s||0,this.p=null},type:null,name:null,t:null,k:0,p:null,toString:function(){var t="[";return t+="Matcher: "+this.name,t+=", Type: "+this.type,t+=", Pattern: "+(this.t?this.t.toString():null),t+="]"},get:function(t,e){var s;return(s=t.chr(this.t,e))?[this.k,s]:!1}}),ee=o(te,{constructor:function(t,e,s){this.$super("constructor",t,e,s),this.type=y,this.p={peek:{},negativepeek:null},this.p.peek[""+e.charAt(0)]=1},get:function(t,e){var s;return(s=t.str(this.t,this.p,e))?[this.k,s]:!1}}),se=o(te,{constructor:function(t,e,s){this.$super("constructor",t,e,s),this.type=v,this.t=e[0],this.p=e[1],this.g=e[2]||0},g:0,get:function(t,e){var s;return(s=t.rex(this.t,this.p,e,this.g))?[this.k,s]:!1}}),ne=o(te,{constructor:function(t,e,s){this.$super("constructor",t,e,s),this.type=E,this.t=null},get:function(t,e){return!1!==e&&t.end(),[this.k,""]}}),ie=o(te,{constructor:function(t,e,s){this.type=O,this.name=t,this.ms=e,this.ownKey=!1!==s},ms:null,ownKey:!0,get:function(t,e){var s,n,i=this.ms,r=i.length;for(s=0;r>s;s++)if(n=i[s].get(t,e))return this.ownKey?[s,n[1]]:n;return!1}}),re=o(te,{constructor:function(t,e,s){this.type=C,this.name=t,this.s=new ie(this.name+"_StartMatcher",e,!1),this.t=this.s.t||null,this.e=s},s:null,e:null,get:function(t,e){var s=this.s.get(t,e);if(s){var n=this.e[s[0]];return h==I(n)&&(n=new ee(this.name+"_EndMatcher",s[1][n+1])),n}return!1}}),oe=function(t,e,s,n){s=s||0;var i,r=t+"_SimpleMatcher",o=I(e);return h==o?e:(n[r]||(i=k==o?new ne(r,e,s):a==o?new te(r,e,s):c==o?new ee(r,e,s):p==o?new se(r,e,s):e,n[r]=i),n[r])},he=function(t,e,s,n,i,r){var o,h,l,u,c,a=!1,f=!1,g=t+"_CompoMatcher";if(!r[g]){if(o=K(e),l=o.length,n)for(u=(l>>1)+1,h=0;u>=h;h++){if(p==I(o[h])||p==I(o[l-1-h])){a=!0;break}if(J(o[h],s)||J(o[l-1-h],s)){f=!0;break}}if(!n||a||f){for(h=0;l>h;h++)o[h]=p==I(o[h])?he(g+"_"+h,o[h],s,n,i,r):oe(g+"_"+h,Q(o[h],s,i),h,r);c=o.length>1?new ie(g,o):o[0]}else c=oe(g,W(o,n),0,r);r[g]=c}return r[g]},le=function(t,e,s,n,i){var r,o,h,l,u,c,a,f=t+"_BlockMatcher";if(!i[f]){for(l=[],u=[],r=U(e),o=0,h=r.length;h>o;o++)c=oe(f+"_0_"+o,Q(r[o][0],s,n),o,i),a=r[o].length>1?oe(f+"_1_"+o,Q(r[o][1],s,n),o,i):c,l.push(c),u.push(a);i[f]=new re(f,l,u)}return i[f]},ue=o({constructor:function(t,e,s,n){this.type=s||null,this.name=t||null,this.t=e||null,this.v=n||null},name:null,type:null,t:null,v:null,isRequired:!1,ERROR:!1,streamPos:null,stackPos:null,actionBefore:null,actionAfter:null,toString:function(){var t="[";return t+="Tokenizer: "+this.name,t+=", Type: "+this.type,t+=", Token: "+(this.t?this.t.toString():null),t+="]"},required:function(t){return this.isRequired=t?!0:!1,this},push:function(t,e,s){return this.stackPos?t.splice(this.stackPos+(s||0),0,e):t.push(e),this},clone:function(){var t,e,s=$.call(arguments),n=s.length;for(t=new this.$class,t.type=this.type,t.name=this.name,t.t=this.t,t.v=this.v,t.isRequired=this.isRequired,t.ERROR=this.ERROR,t.streamPos=this.streamPos,t.stackPos=this.stackPos,t.actionBefore=this.actionBefore,t.actionAfter=this.actionAfter,e=0;n>e;e++)t[s[e]]=this[s[e]];return t},get:function(t,e){return this.t.get(t)?(e.t=this.type,this.v):!1}}),ce=o(ue,{constructor:function(t,e,s,n,i){this.$super("constructor",t,e,s,n),this.multiline=!1!==i,this.e=null},multiline:!1,e:null,get:function(t,e){var s=!1,n=!1;if(e.inBlock==this.name?(n=!0,this.e=e.endBlock):!e.inBlock&&(this.e=this.t.get(t))&&(n=!0,e.inBlock=this.name,e.endBlock=this.e),n){for(this.stackPos=e.stack.length,s=this.e.get(t);!s&&!t.eol();){if(this.e.get(t)){s=!0;break}t.nxt()}return s=s||!this.multiline&&t.eol(),s?(e.inBlock=null,e.endBlock=null):this.push(e.stack,this),e.t=this.type,this.v}return e.inBlock=null,e.endBlock=null,!1}}),ae=o(ce,{constructor:function(t,e,s,n,i,r){this.$super("constructor",t,e,s,n),this.esc=i||"\\",this.multiline=r||!1,this.e=null},esc:"\\",get:function(t,e){var s="",n=!1,i=!1,r=!1;if(e.inBlock==this.name?(i=!0,this.e=e.endBlock):!e.inBlock&&(this.e=this.t.get(t))&&(i=!0,e.inBlock=this.name,e.endBlock=this.e),i){for(this.stackPos=e.stack.length,n=this.e.get(t);!n&&!t.eol();){if(!r&&this.e.get(t)){n=!0;break}s=t.nxt(),r=!r&&s==this.esc}return n=n||!(r&&this.multiline),n?(e.inBlock=null,e.endBlock=null):this.push(e.stack,this),e.t=this.type,this.v}return e.inBlock=null,e.endBlock=null,!1}}),fe=o(ue,{constructor:function(t,e){this.$super("constructor",t,e),this.ts=null},ts:null,makeToks:function(t){return t&&(this.ts=K(t),this.t=this.ts[0]),this}}),pe=o(fe,{constructor:function(t,e){this.type=L,this.name=t||null,e&&this.makeToks(e)},get:function(t,e){this.isRequired=!1,this.ERROR=!1,this.streamPos=t.pos;var s=this.t,n=s.get(t,e);return s.ERROR&&t.bck2(this.streamPos),n}}),ge=o(fe,{constructor:function(t,e){this.type=T,this.name=t||null,e&&this.makeToks(e)},get:function(t,e,s){var n,i,r,o=this.ts,h=o.length,l=0;for(this.isRequired=!1,this.ERROR=!1,this.streamPos=t.pos,this.stackPos=e.stack.length,n=0;h>n;n++){if(i=o[n],r=i.get(t,e,s),!1!==r)return this.push(e.stack,this),r;i.ERROR&&(l++,t.bck2(this.streamPos))}return!1}}),ke=o(fe,{constructor:function(t,e){this.type=_,this.name=t||null,e&&this.makeToks(e),this.foundOne=!1},foundOne:!1,get:function(t,e,s){var n,i,r,o=this.ts,h=o.length,l=0,u=0;for(this.isRequired=!this.foundOne,this.ERROR=!1,this.streamPos=t.pos,this.stackPos=e.stack.length,r=0;h>r;r++){if(i=o[r],n=i.get(t,e,s),l+=i.isRequired?1:0,!1!==n)return this.foundOne=!0,this.isRequired=!1,this.ERROR=!1,this.push(e.stack,this.clone("ts","foundOne")),this.foundOne=!1,n;i.ERROR&&(u++,t.bck2(this.streamPos))}return this.ERROR=this.foundOne?!1:!0,!1}}),me=o(fe,{constructor:function(t,e){this.type=S,this.name=t||null,e&&this.makeToks(e)},get:function(t,e,s){var n,i,r,o=this.ts,h=o.length,l=0,u=0;for(this.isRequired=!0,this.ERROR=!1,this.streamPos=t.pos,r=0;h>r;r++){if(i=o[r],n=i.get(t,e,s),l+=i.isRequired?1:0,!1!==n)return n;i.ERROR&&(u++,t.bck2(this.streamPos))}return this.isRequired=l>0?!0:!1,this.ERROR=h==u&&l>0?!0:!1,!1}}),Re=o(fe,{constructor:function(t,e){this.type=q,this.name=t||null,e&&this.makeToks(e)},get:function(t,e,s){var n,i,r=this.ts,o=r.length,h=!1;if(this.isRequired=!0,this.ERROR=!1,this.streamPos=t.pos,this.stackPos=e.stack.length,n=r[0],i=n.required(!0).get(t,e,s),!1!==i){this.stackPos=e.stack.length;for(var l=o-1;l>0;l--)this.push(e.stack,r[l].required(!0),o-l);h=i}else n.ERROR?(this.ERROR=!0,t.bck2(this.streamPos)):n.isRequired&&(this.ERROR=!0);return h}}),de=o(fe,{constructor:function(t,e){this.type=G,this.name=t||null,e&&this.makeToks(e)},get:function(t,e,s){var n,i,r=this.ts,o=r.length,h=!1;if(this.isRequired=!1,this.ERROR=!1,this.streamPos=t.pos,this.stackPos=e.stack.length,n=r[0],i=n.required(!1).get(t,e,s),!1!==i){this.stackPos=e.stack.length;for(var l=o-1;l>0;l--)this.push(e.stack,r[l].required(!0),o-l);h=i}else n.ERROR&&t.bck2(this.streamPos);return h}}),ye=function(t,e){var s,n,r,o=U(t.tokens.slice());for(i=0,l=o.length;l>i;i++)s=o[i][0],n=o[i].length>1?o[i][1]:o[i][0],r=o[i].length>2?o[i][2]:"",null===n?(e.line=e.line||[],e.line.push(s)):(e.block=e.block||[],e.block.push([s,n,r]))},ve=function(t,e,s,i,r,o,h,l,u,c){var a,f,p,g,k,m=null;if(!u[t]){if(a=i[t]||r[t]||null)if(f=a.type||"simple",f=D[f.toUpperCase()],k=a.action||null,B==f||A==f)A==f&&ye(a,c),m=new ce(t,le(t,a.tokens.slice(),e,h,l),f,o[t]||n,a.multiline);else if(w==f)m=new ae(t,le(t,a.tokens.slice(),e,h,l),f,o[t]||n,a.escape||"\\",a.multiline||!1);else if(x==f)m=new ue(t,he(t,a.tokens.slice(),e,s[t],h,l),f,o[t]||n);else if(M==f){p=j[a.match.toUpperCase()],g=K(a.tokens).slice();for(var R=0,d=g.length;d>R;R++)g[R]=ve(g[R],e,s,i,r,o,h,l,u,c);m=L==p?new pe(t,g):T==p?new ge(t,g):_==p?new ke(t,g):S==p?new me(t,g):new Re(t,g)}else if(G==f){m=U(K(a.tokens).slice()).slice();for(var R=0,d=m.length;d>R;R++){for(var y=m[R],v=0,E=y.length;E>v;v++)y[v]=ve(y[v],e,s,i,r,o,h,l,u,c);m[R]=new de(t+"_NGRAM_"+R,y)}}u[t]=m}return u[t]},Ee=o({constructor:function(t,e){this.LOC=e,this.Grammar=t,this.Comments=t.Comments||{},this.Tokens=t.Parser||[],this.DEF=this.LOC.DEFAULT,this.ERR=t.Style&&t.Style.error?t.Style.error:this.LOC.ERROR,this.electricChars=t.electricChars?t.electricChars:!1},LOC:null,ERR:null,DEF:null,Grammar:null,Comments:null,Tokens:null,electricChars:!1,getToken:function(t,e){var s,n,i,r,o,h=this.Tokens,l=h.length,u=this.LOC,c=this.DEF,a=this.ERR;if(o=e.stack,r=(new X).fromStream(t),r.spc())return e.t=P,c;for(;o.length;){if(n=o.pop(),i=n.get(r,e,u),!1!==i)return i;if(n.ERROR||n.isRequired)return o.length=0,r.nxt(),e.t=b,a}for(s=0;l>s;s++){if(n=h[s],i=n.get(r,e,u),!1!==i)return i;if(n.ERROR||n.isRequired)return o.length=0,r.nxt(),e.t=b,a}return r.nxt(),e.t=P,c},indent:function(){return CodeMirror.Pass}}),Oe=function(t,e){return new Ee(t,e)},Ce=function(t){return function(e,s){return t.LOC.conf=e,t.LOC.parserConf=s,{startState:function(){return new Y},electricChars:t.electricChars,lineComment:t.Comments.line?t.Comments.line[0]:null,blockCommentStart:t.Comments.block?t.Comments.block[0][0]:null,blockCommentEnd:t.Comments.block?t.Comments.block[0][1]:null,blockCommentLead:t.Comments.block?t.Comments.block[0][2]:null,copyState:function(t){return t.clone()},token:function(e,s){return t.getToken(e,s)},indent:function(e,s,n){return t.indent(e,s,n)}}}},be={RegExpID:null,RegExpGroups:null,Style:{error:"error"},Lex:null,Syntax:null,Parser:null},Pe=function(t){var e,s,n,i,r,o,h,l,u,c,a,f={},g={},k={},m={};if(t.__parsed)return t;for(t=Z(t,be),e=t.RegExpID||null,t.RegExpID=null,delete t.RegExpID,s=t.RegExpGroups||{},t.RegExpGroups=null,delete t.RegExpGroups,h=t.Lex||{},t.Lex=null,delete t.Lex,l=t.Syntax||{},t.Syntax=null,delete t.Syntax,o=t.Style||{},r=t.Parser||[],i=r.length,n=[],u=0;i>u;u++)c=r[u],a=ve(c,e,s,h,l,o,f,g,k,m)||null,a&&(p==I(a)?n=n.concat(a):n.push(a));return t.Parser=n,t.Style=o,t.Comments=m,t.__parsed=!0,t},xe={VERSION:r,extend:Z,parse:Pe,getMode:function(t,e){n=null,t=Pe(t);var s={DEFAULT:e||n,ERROR:be.Style.error};return Ce(Oe(t,s))}};return xe});