/**
*
*   CodeMirrorGrammar
*   Transform a grammar specification in JSON format,
*   into a CodeMirror syntax-highlight parser mode
*
*   https://github.com/foo123/codemirror-grammar
*
**/(function(){var n="0.1",e=(Array.prototype.slice,Object.prototype.hasOwnProperty),i=Object.prototype.toString,r=function(n){return"number"==typeof n||n instanceof Number},l=function(n){return n&&("string"==typeof n||n instanceof String)&&1==n.length},s=function(n){return n&&("string"==typeof n||n instanceof String)},u=function(n){return n&&("[object RegExp]"==i.call(n)||n instanceof RegExp)},o=function(n){return n&&"[object Array]"==i.call(n)},a=function(n){return n&&"[object Object]"==i.call(n)},f=function(n){return o(n)?n:[n]},c=function(n){if(!a(n)&&!o(n))return n;var t={};for(var i in n)e.call(n,i)&&(t[i]=a(n[i])?c(n[i]):o(n[i])?n[i].slice():n[i]);return t},m=function(n,t){if(!a(t)&&!o(t))return c(n);var i={};for(var r in t)e.call(t,r)&&(i[r]=e.call(n,r)?a(n[r])&&!s(n[r])?m(n[r],t[r]):o(n[r])?n[r].slice():n[r]:c(t[r]));return i},b={RegExpID:null,RegExpGroups:null,TokenOrder:["comments","blocks","blocks2","blocks3","blocks4","blocks5","numbers","numbers2","numbers3","strings","strings2","strings3","strings4","strings5","keywords","builtins","operators","delimiters","atoms","meta","defines","identifiers","identifiers2","identifiers3","identifiers4","identifiers5"],Style:{error:"error",comment:"comment",meta:"meta",defines:"def",atom:"atom",keyword:"keyword",builtin:"builtin",operator:"operator",identifier:"variable",identifier2:"variable",identifier3:"variable",identifier4:"variable",identifier5:"variable",number:"number",number2:"number",number3:"number",string:"string",string2:"string",string3:"string",string4:"string",string5:"string",block:"string",block2:"string",block3:"string",block4:"string",block5:"string",delimiter:"meta"},comments:{line:null,block:null},blocks:null,blocks2:null,blocks3:null,blocks4:null,blocks5:null,identifiers:null,identifiers2:null,identifiers3:null,identifiers4:null,identifiers5:null,numbers:null,numbers2:null,numbers3:null,strings:null,strings2:null,strings3:null,strings4:null,strings5:null,operators:null,delimiters:null,atoms:null,meta:null,defines:null,keywords:null,builtins:null,indent:null},g={RegExpID:null,RegExpGroups:null,TokenOrder:["comments","blocks","blocks2","blocks3","blocks4","blocks5","doctype","atoms","numbers","numbers2","numbers3","strings","strings2","strings3","strings4","strings5","meta","tags","tags2","tags3","defines","keywords","builtins","identifiers","identifiers2","identifiers3","identifiers4","identifiers5"],Style:{error:"error",comment:"comment",meta:"meta",defines:"def",atom:"atom",keyword:"keyword",builtin:"builtin",operator:"operator",assignment:null,tag:"tag",tag2:"tag",tag3:"tag",attribute:"attribute",attribute2:"attribute",attribute3:"attribute",identifier:"variable",identifier2:"variable",identifier3:"variable",identifier4:"variable",identifier5:"variable",number:"number",number2:"number",number3:"number",string:"string",string2:"string",string3:"string",string4:"string",string5:"string",block:"string",block2:"string",block3:"string",block4:"string",block5:"string",delimiter:"meta"},comments:{line:null,block:null},blocks:null,blocks2:null,blocks3:null,blocks4:null,blocks5:null,tags:null,tags2:null,tags3:null,autoclose:null,attributes:null,attributes2:null,attributes3:null,identifiers:null,identifiers2:null,identifiers3:null,identifiers4:null,identifiers5:null,numbers:null,numbers2:null,numbers3:null,strings:null,strings2:null,strings3:null,strings4:null,strings5:null,atoms:null,meta:null,defines:null,keywords:null,builtins:null,assignments:null,operators:null,delimiters:null,indent:null},d=1,k=2,p=4,h=8,y=16,v=32,T=64,x=128,E=256,w=512,z=1024,R=2048,S=4096,I=8192,G=16384,D=32768,L=65536,O=131072,A=262144,_=1,U=2,j=33,N=34,F=36,M=T_LINEMATCHER=40,C=64,P=128,$=200,H=220,V=/([\-\.\*\+\?\^\$\{\}\(\)\|\[\]\/\\])/g,q=function(n,e){return e.length-n.length},B=function(n,e){return s(e)&&s(n)&&e.length&&e.length<=n.length&&e==n.substr(0,e.length)},J=function(n,e){if(!n||r(n))return n;var t=e?e.length||0:0;return t&&e==n.substr(0,t)?new RegExp("^("+n.substr(t)+")"):n},K=function(n){for(var e=0,t=n.length;t>e;e++)n[e]=n[e].replace(V,"\\$1");return new RegExp("^(("+n.sort(q).join(")|(")+"))\\b")},Q=function(n,e,t){var i;t=t||0,this.type=n||N,j==this.type?this.match=function(n,i){i=!1!==i;var r=e,l=ch=n.string.charAt(n.pos)||"";return r==l?(i&&(n.pos+=1),{key:t,val:ch}):!1}:N==this.type?(i=e.length,this.match=function(n,r){r=!1!==r;var l=e,s=str=n.string.substr(n.pos,i);return l==s?(r&&(n.pos+=i),{key:t,val:str}):!1}):this.match=F==this.type?function(n,i){i=!1!==i;var r=n.string.slice(n.pos).match(e);return!r||r.index>0?!1:(i&&(n.pos+=r[0].length),{key:t,val:r})}:M==this.type?function(n,e){return!1!==e&&(n.pos=n.string.length),{key:t,val:""}}:function(){return!1}},W=function(n,e){var t=n.length;e=!1!==e,this.type=C,this.match=0>=t?function(){return!1}:1==t?n[0].match:e?function(e,i){var r,l;for(r=0;t>r;r++)if(l=n[r].match(e,i))return{key:r,val:l.val};return!1}:function(e,i){var r,l;for(r=0;t>r;r++)if(l=n[r].match(e,i))return l;return!1}},X=function(n,e){var t,i,l=new W(n,!1);this.type=P,this.match=function(n,s){return t=l.match(n,s),t?(i=e[t.key],r(i)&&(i=Y(t.val[i+1])),i):!1}},Y=function(n,e){return e=e||0,r(n)?n:null==n?new Q(M,n,e):l(n)?new Q(j,n,e):s(n)?new Q(N,n,e):u(n)?new Q(F,n,e):n},Z=function(n,e,t){var i,r,l,s,u=!1,a=!1;if(i=f(n),l=i.length,t)for(s=(l>>1)+1,r=0;s>=r;r++){if(o(i[r])||o(i[l-1-r])){u=!0;break}if(B(i[r],e)||B(i[l-1-r],e)){a=!0;break}}if(!t||u||a){for(r=0;l>r;r++)i[r]=o(i[r])?Z(i[r],e,t):Y(J(i[r],e),r);return new W(i)}return new W([Y(K(i))])},ne=function(n,e){var t,i,r,l,s,u,a;for(l=[],s=[],t=f(n),o(t[0])||(t=[t]),i=0,r=t.length;r>i;i++)u=Y(J(t[i][0],e),i),a=t[i].length>1?Y(J(t[i][1],e),i):u,l.push(u),s.push(a);return new X(l,s)},ee=function(n,e,t,i){var r=function(r,l){for(var s=!1;!r.eol();){if(n.match(r)){s=!0;break}r.next()}return s&&(l.tokenize=i||null),l.lastToken=e,t};return r.type=e|D,r},te=function(n,e,t,i,r){var l=function(l,s){for(var u=!1,o="",a=!1;!l.eol();){if(!u&&n.match(l)){a=!0;break}o=l.next(),u=!u&&"\\"==o}return(a||!u&&!i)&&(s.tokenize=r||null),s.lastToken=e,t};return l.type=e,l},ie=function(n,e,t){var i=e.DEFAULT,r=e.style,l=e.tagNames,s=e.attributes,u=e.assignments,o=e.strings,a=!1,f=function(e,c){var m,b;return c.lastToken,!a&&l&&(m=l.match(e))?(c.lastToken=z,a=!0,r.tag):a?e.eatSpace()?(c.lastToken=d,i):n.match(e)?(c.tokenize=t||null,c.lastToken=I,r.tag):s&&s.match(e)?(c.lastToken=R,r.attribute):u&&u.match(e)?(c.lastToken=S,i):o&&(b=o.match(e))?(c.tokenize=te(b,x,r.string,!1,f),c.tokenize(e,c)):(c.lastToken=d,i):(c.lastToken=G,r.error)};return f.type=z,f},re=function(n,e){var t=function(t,i){for(var r,l=!1,s=1;!l&&(r=t.next(),null!=r);)if("<"!=r)if(">"!=r);else{if(1==s){i.tokenize=e||null;break}s--}else s++;return i.lastToken=L,n};return t.type=L,t},le=function(n,e){var t=e.DEFAULT,i=(n.Style||{},n.TokenOrder||[]),r=i.length;n.hasIndent,n.indent;var l=function(n,l){var s,u,o,a,f,c,m=e.conf.multiLineStrings;if(n.eatSpace())return l.lastToken=d,t;for(s=0;r>s;s++)if(u=i[s]){if(o=u[0],a=u[1],f=u[2],(p|D)&a&&(c=o.match(n)))return l.tokenize=ee(c,a,f),l.tokenize(n,l);if(x&a&&(c=o.match(n)))return l.tokenize=te(c,a,f,m),l.tokenize(n,l);if(o.match(n))return l.lastToken=a,f}return n.next(),l.lastToken=d,t};return l.type=$,l},se=function(n,e){var t=e.DEFAULT,i=n.Style||{},r=n.TokenOrder||[],l=r.length,s=n.tagNames||null,u=n.attributes||null,o=(n.attributes2||null,n.attributes3||null,n.assignments||null);return n.hasIndent,n.indent,function(a,f){var c,m,b,g,k,h,y=e.conf.multiLineStrings;if(a.eatSpace())return f.lastToken=d,t;for(c=0;l>c;c++)if(m=r[c]){if(b=m[0],g=m[1],k=m[2],(p|D)&g&&(h=b.match(a)))return f.tokenize=ee(h,g,k),f.tokenize(a,f);if(L&g&&b.match(a))return f.tokenize=re(k),f.tokenize(a,f);if(z&g&&(h=b.match(a)))return e.style=i,e.tagNames=s,e.attributes=u,e.assignments=o,e.strings=n.strings,f.tokenize=ie(h,e),f.tokenize(a,f);if(x&g&&(h=b.match(a)))return f.tokenize=te(h,g,k,y),f.tokenize(a,f);if(b.match(a))return f.lastToken=g,k}return a.next(),f.lastToken=d,t}},ue=function(n,e,t){t.DEFAULT,e.hasIndent;var i=function(e,i){t.conf.multiLineStrings,t.basecolumn||0,t.conf.indentUnit;var r;return t.indentInfo=null,null==i.tokenize&&(i.tokenize=n),r=i.tokenize(e,i)};return i.type=H,i},oe=function(n){return n.DEFAULT,function(){return n.basecolumn||0,n.conf.indentUnit,CodeMirror.Pass}},ae={VERSION:n,parseGrammar:function(n,e){return n.type&&"markup-like"==n.type?ae.parseMarkupLikeGrammar(n,e||g):ae.parseProgrammingLikeGrammar(n,e||b)},parseMarkupLikeGrammar:function(n,e){var i,r,l,s,u,o,a,c,b,g,d,R,S,I=[];if(n.__parsed)return n;for(n=m(n,e),u=n.RegExpID||null,n.RegExpID=null,delete n.RegExpID,o=n.RegExpGroups||{},n.RegExpGroups=null,delete n.RegExpGroups,n.type=U,a=n.TokenOrder||[],c=a.length,b=n.Style||{},t=0;c>t;t++)if(g=a[t],n[g]){if(d=null,"comments"==g){if(i=[],n.comments.line)for(r=f(n.comments.line),l=0,s=r.length;s>l;l++)i.push([r[l],null]);n.comments.block&&(r=f(n.comments.block),i.push([r[0],r[1]?r[1]:r[0]])),d=i.length?ne(i,u):null,R=p,S=b.comment}else if("blocks"==g)d=ne(n.blocks,u)||null,R=D,S=b.block;else if("blocks2"==g)d=ne(n.blocks2,u)||null,R=D,S=b.block2;else if("blocks3"==g)d=ne(n.blocks3,u)||null,R=D,S=b.block3;else if("blocks4"==g)d=ne(n.blocks4,u)||null,R=D,S=b.block4;else if("blocks5"==g)d=ne(n.blocks5,u)||null,R=D,S=b.block5;else if("tags"==g){i=[],r=[];var G=f(n.tags);for(l=0,s=G.length;s>l;l++)i.push([G[l][0],G[l][1]]),r=r.concat(G[l][2]);i=ne(i,u)||null,r=Z(r,u,o.tags)||null,d=i,R=z,S=b.tag,n.tagNames=r}else{if("tags2"==g)continue;if("tags3"==g)continue;if("doctype"==g)continue;if("strings"==g)d=ne(n.strings,u)||null,R=x,S=b.string;else if("strings2"==g)d=ne(n.strings2,u)||null,R=x,S=b.string2;else if("strings3"==g)d=ne(n.strings3,u)||null,R=x,S=b.string3;else if("strings4"==g)d=ne(n.strings4,u)||null,R=x,S=b.string4;else if("strings5"==g)d=ne(n.strings5,u)||null,R=x,S=b.string5;else if("numbers"==g)d=Z(n.numbers,u,o.numbers)||null,R=w,S=b.number;else if("numbers2"==g)d=Z(n.numbers2,u,o.numbers2)||null,R=w,S=b.number2;else if("numbers3"==g)d=Z(n.numbers3,u,o.numbers3)||null,R=w,S=b.number3;else if("identifiers"==g)d=Z(n.identifiers,u,o.identifiers)||null,R=E,S=b.identifier;else if("identifiers2"==g)d=Z(n.identifiers2,u,o.identifiers2)||null,R=E,S=b.identifier2;else if("identifiers3"==g)d=Z(n.identifiers3,u,o.identifiers3)||null,R=E,S=b.identifier3;else if("identifiers4"==g)d=Z(n.identifiers4,u,o.identifiers4)||null,R=E,S=b.identifier4;else if("identifiers5"==g)d=Z(n.identifiers5,u,o.identifiers5)||null,R=E,S=b.identifier5;else if("atoms"==g)d=Z(n.atoms,u,o.atoms)||null,R=y,S=b.atom;else if("meta"==g)d=Z(n.meta,u,o.meta)||null,R=k,S=b.meta;else if("defines"==g)d=Z(n.defines,u,o.defines)||null,R=h,S=b.defines;else if("keywords"==g)d=Z(n.keywords,u,o.keywords)||null,R=v,S=b.keyword;else if("builtins"==g)d=Z(n.builtins,u,o.builtins)||null,R=T,S=b.builtin;else{if("operators"==g)continue;if("delimiters"==g)continue}}d?(n[g]=d,I.push([d,R,S])):n[g]=null}return n.TokenOrder=I,n.attributes=n.attributes?Z(n.attributes,u,o.attributes):null,n.attributes2=n.attributes2?Z(n.attributes2,u,o.attributes2):null,n.attributes3=n.attributes3?Z(n.attributes3,u,o.attributes3):null,n.assignments=n.assignments?Z(n.assignments,u,o.assignments):null,n.indent=null,n.hasIndent=!1,n.__parsed=!0,n},parseProgrammingLikeGrammar:function(n,e){var i,r,l,s,u,o,a,c,b,g,d,z,R,S=[];if(n.__parsed)return n;for(n=m(n,e),u=n.RegExpID||null,n.RegExpID=null,delete n.RegExpID,o=n.RegExpGroups||{},n.RegExpGroups=null,delete n.RegExpGroups,n.type=_,a=n.TokenOrder||[],c=a.length,b=n.Style||{},t=0;c>t;t++)if(g=a[t],n[g]){if(d=null,"comments"==g){if(i=[],n.comments.line)for(r=f(n.comments.line),l=0,s=r.length;s>l;l++)i.push([r[l],null]);n.comments.block&&(r=f(n.comments.block),i.push([r[0],r[1]?r[1]:r[0]])),d=i.length?ne(i,u):null,z=p,R=b.comment}else"blocks"==g?(d=ne(n.blocks,u)||null,z=D,R=b.block):"blocks2"==g?(d=ne(n.blocks2,u)||null,z=D,R=b.block2):"blocks3"==g?(d=ne(n.blocks3,u)||null,z=D,R=b.block3):"blocks4"==g?(d=ne(n.blocks4,u)||null,z=D,R=b.block4):"blocks5"==g?(d=ne(n.blocks5,u)||null,z=D,R=b.block5):"strings"==g?(d=ne(n.strings,u)||null,z=x,R=b.string):"strings2"==g?(d=ne(n.strings2,u)||null,z=x,R=b.string2):"strings3"==g?(d=ne(n.strings3,u)||null,z=x,R=b.string3):"strings4"==g?(d=ne(n.strings4,u)||null,z=x,R=b.string4):"strings5"==g?(d=ne(n.strings5,u)||null,z=x,R=b.string5):"numbers"==g?(d=Z(n.numbers,u,o.numbers)||null,z=w,R=b.number):"numbers2"==g?(d=Z(n.numbers2,u,o.numbers2)||null,z=w,R=b.number2):"numbers3"==g?(d=Z(n.numbers3,u,o.numbers3)||null,z=w,R=b.number3):"identifiers"==g?(d=Z(n.identifiers,u,o.identifiers)||null,z=E,R=b.identifier):"identifiers2"==g?(d=Z(n.identifiers2,u,o.identifiers2)||null,z=E,R=b.identifier2):"identifiers3"==g?(d=Z(n.identifiers3,u,o.identifiers3)||null,z=E,R=b.identifier3):"identifiers4"==g?(d=Z(n.identifiers4,u,o.identifiers4)||null,z=E,R=b.identifier4):"identifiers5"==g?(d=Z(n.identifiers5,u,o.identifiers5)||null,z=E,R=b.identifier5):"atoms"==g?(d=Z(n.atoms,u,o.atoms)||null,z=y,R=b.atom):"meta"==g?(d=Z(n.meta,u,o.meta)||null,z=k,R=b.meta):"defines"==g?(d=Z(n.defines,u,o.defines)||null,z=h,R=b.defines):"keywords"==g?(d=Z(n.keywords,u,o.keywords)||null,z=v,R=b.keyword):"builtins"==g?(d=Z(n.builtins,u,o.builtins)||null,z=T,R=b.builtin):"operators"==g?(d=Z(n.operators,u,o.operators)||null,z=O,R=b.operator):"delimiters"==g&&(d=Z(n.delimiters,u,o.delimiters)||null,z=A,R=b.delimiter);d?(n[g]=d,S.push([d,z,R])):n[g]=null}return n.TokenOrder=S,n.indent=null,n.hasIndent=!1,n.__parsed=!0,n},getMode:function(n,e,t){n=ae.parseGrammar(n,e);var i,r,l,s={DEFAULT:t||null};return i=U==n.type?se(n,s):le(n,s),r=ue(i,n,s),l=oe(s),function(n,e){return s.conf=n,s.parserConf=e,{startState:function(n){return s.basecolumn=n||0,{tokenize:null,lastToken:d}},token:r,indent:l}}}};"undefined"!=typeof module&&module.exports?module.exports=ae:"undefined"!=typeof exports?exports=ae:this.CodeMirrorGrammar=ae}).call(this);